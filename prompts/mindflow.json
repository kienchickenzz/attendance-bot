{
  "sequence": [
    {
      "id": "7974e50e072b48b916f976568a513781",
      "type": "session",
      "componentType": "task",
      "properties": {
        "extra": "{\n    \"company_name\": \"CMC TS\",\n    \"company_contact\": \"Hotline: 0899507188\",\n    \n    \"assistant_role\": \"Assistant named Minh Hiá»ƒn, specialized virtual assistant for comprehensive attendance and time management support. Assistant must always communicate in the User's preferred language and adapt to their communication style\",\n    \"assistant_skill\": \"Assistant is a knowledgeable specialist in attendance management systems, offering expert guidance on time tracking, work schedule optimization, and attendance policy compliance. Assistant excels at analyzing user attendance patterns, identifying potential issues, and providing actionable insights for improved time management. Assistant demonstrates proficiency in handling complex attendance calculations, comparative analysis, and generating meaningful reports. Assistant always responds in the language used by the User, adapting tone and complexity to match user preferences\",\n    \"assistant_scope\": \"Monitor and report real-time attendance status including check-in/check-out verification \\n- Analyze historical attendance data, calculate work hours, overtime, and attendance statistics \\n- Generate personalized attendance insights and recommendations\",\n    \"assistant_tone\": \"- Humor and sarcasm can be tricky in text. Let's keep the conversation straightforward and avoid misunderstandings\\n- Even in casual conversations, Assistant must maintain a level of professionalism. Let's keep the interaction respectful and professional.\",\n    \n    \"vn_pronoun\": \"Trong tiáº¿ng viá»‡t, Assistant luÃ´n lÃ  \\\"Em\\\" vÃ  Assistant PHáº¢I tá»± xÆ°ng lÃ  \\\"Em\\\" trong táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p. \\nAssistant gá»i User theo danh xÆ°ng lá»‹ch sá»± lÃ  \\\"anh\\\" náº¿u giá»›i tÃ­nh lÃ  NAM hoáº·c \\\"chá»‹\\\" náº¿u giá»›i tÃ­nh lÃ  Ná»® vÃ  náº¿u chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh thÃ¬ gá»i User lÃ  \\\"anh/chá»‹\\\". \\n\\nXem cÃ¡c vÃ­ dá»¥ bÃªn dÆ°á»›i Ä‘á»ƒ hiá»ƒu rÃµ cÃ¡ch dÃ¹ng\\nUser: Xin chÃ o\\nReasoning: User nÃ³i xin chÃ o nhÆ°ng khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh nÃªn Assistant sáº½ gá»i User lÃ  \\\"anh/chá»‹\\\", Assistant sáº½ lÃ  \\\"em\\\" \\nAssistant: Dáº¡, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh/chá»‹?\\n\\nUser: ChÃ o em, anh lÃ  TÃ¹ng, cho anh há»i má»™t chÃºt.\\nReasoning: User xÆ°ng \\\"anh\\\" vÃ  giá»›i thiá»‡u tÃªn lÃ  \\\"TÃ¹ng\\\" nÃªn xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh lÃ  Nam nÃªn sáº½ gá»i User báº±ng danh xÆ°ng vÃ  tÃªn lÃ  \\\"Anh TÃ¹ng\\\". Assistant sáº½ lÃ  \\\"Em\\\"\\nAssistant: ChÃ o anh TÃ¹ng, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh.\"\n}"
      },
      "name": "Session Manager"
    },
    {
      "id": "040cbb402d38d3e6a7eea76162a38c6f",
      "type": "if",
      "componentType": "switch",
      "properties": {
        "condition": "session.recall_counter > 3"
      },
      "branches": {
        "true": [
          {
            "id": "13dd58e409027c5d3a1e757d979bdaab",
            "type": "setVar",
            "componentType": "task",
            "properties": {
              "varName": "session.recall_counter",
              "varValue": "0"
            },
            "name": "Var [session.recall_counter]"
          },
          {
            "id": "875fbf27694a010a89e63834b57b14f4",
            "type": "botSendText",
            "componentType": "task",
            "properties": {
              "text": "Dáº¡, em xin lá»—i, bÃªn em vá»«a gáº·p chÃºt váº¥n Ä‘á» vá»›i Ä‘Æ°á»ng truyá»n máº¡ng. Anh/chá»‹ gá»­i láº¡i thÃ´ng tin vá»«a rá»“i giÃºp em nhÃ©."
            },
            "name": "Bot Send Text"
          },
          {
            "id": "a523a82d67d20d06df6433e17e02bf92",
            "type": "clearTopic",
            "componentType": "task",
            "properties": {},
            "name": "Clear Topic"
          },
          {
            "id": "56ecbb1985c0dc4559b03bd6f8874c2f",
            "type": "break",
            "componentType": "task",
            "properties": {},
            "name": "Break"
          }
        ],
        "false": []
      },
      "name": "Recall counters exceeded?"
    },
    {
      "id": "10bc708dba622d91344d962b1458cc92",
      "type": "python",
      "componentType": "task",
      "properties": {
        "varName": "user_id",
        "expression": "def get_user_input( input ):\n    user_id, user_question = input.split( \"|\", 1 )\n    return user_id\n\nhuman_input = \"{{ human_input }}\"\nprint( get_user_input( human_input ) )"
      },
      "name": "Python"
    },
    {
      "id": "6cb8a7e5315c62396f00dbf698b02ca7",
      "type": "python",
      "componentType": "task",
      "properties": {
        "varName": "raw_user_input",
        "expression": "def get_user_input( input ):\n    user_id, user_input = input.split( \"|\", 1 )\n    return user_input\n\nhuman_input = \"{{ human_input }}\"\nprint( get_user_input( human_input ) )"
      },
      "name": "Python"
    },
    {
      "id": "acd26cd265b849c20f82db09a87f5bf6",
      "type": "router",
      "componentType": "task",
      "properties": {
        "setting": [
          {
            "topic": "greetings",
            "phrases": [
              "hello",
              "hi",
              "chÃ o báº¡n",
              "xin chÃ o",
              "cÃ³ ai á»Ÿ Ä‘Ã¢y khÃ´ng"
            ],
            "keywords": [
              "hello",
              "hi",
              "chÃ o báº¡n",
              "xin chÃ o",
              "cÃ³ ai á»Ÿ Ä‘Ã¢y khÃ´ng"
            ]
          },
          {
            "topic": "attendance",
            "phrases": [
              "check-in",
              "check in",
              "check-out",
              "check out",
              "cháº¥m cÃ´ng",
              "vÃ o lÃ m",
              "giá» vÃ o",
              "giá» ra",
              "thá»i gian vÃ o",
              "thá»i gian ra",
              "Ä‘i muá»™n",
              "ngÃ y cÃ´ng",
              "Ä‘Æ°á»£c tÃ­nh ngÃ y cÃ´ng",
              "Ä‘i lÃ m Ä‘áº§y Ä‘á»§",
              "bá»‹ trá»« cÃ´ng",
              "vi pháº¡m",
              "Ä‘i muá»™n",
              "vá» muá»™n",
              "vá» sá»›m",
              "khÃ´ng Ä‘á»§ cÃ´ng",
              "bá»‹ trá»« giá»",
              "bá»‹ trá»« cÃ´ng",
              "Ä‘i trá»…",
              "hÃ´m nay",
              "hÃ´m qua",
              "hÃ´m trÆ°á»›c",
              "hÃ´m kia",
              "ngÃ y X (cá»¥ thá»ƒ: 10/7, 1/8, 10, 12, 15, v.v.)",
              "thá»© X (thá»© 2, thá»© 3, thá»© 4, thá»© 5, thá»© 7, v.v.)",
              "tuáº§n nÃ y",
              "tuáº§n trÆ°á»›c",
              "tuáº§n trÆ°á»›c ná»¯a",
              "tuáº§n vá»«a rá»“i",
              "thÃ¡ng nÃ y",
              "thÃ¡ng vá»«a rá»“i",
              "thÃ¡ng trÆ°á»›c",
              "Ä‘áº§u tuáº§n",
              "Ä‘áº§u thÃ¡ng",
              "tá»« ngÃ y X Ä‘áº¿n ngÃ y Y",
              "tÃ´i Ä‘Ã£ â€¦ chÆ°a",
              "tÃ´i â€¦ lÃºc nÃ o",
              "lÃ  lÃºc nÃ o",
              "thÃ¬ sao",
              "tháº¿ nÃ o",
              "trong khoáº£ng thá»i gian Ä‘Ã³",
              "ÄÃ³ lÃ  nhá»¯ng ngÃ y nÃ o?"
            ],
            "keywords": [
              "check-in",
              "check in",
              "check-out",
              "check out",
              "cháº¥m cÃ´ng",
              "vÃ o lÃ m",
              "giá» vÃ o",
              "giá» ra",
              "thá»i gian vÃ o",
              "thá»i gian ra",
              "Ä‘i muá»™n",
              "ngÃ y cÃ´ng",
              "Ä‘Æ°á»£c tÃ­nh ngÃ y cÃ´ng",
              "Ä‘i lÃ m Ä‘áº§y Ä‘á»§",
              "bá»‹ trá»« cÃ´ng",
              "vi pháº¡m",
              "Ä‘i muá»™n",
              "vá» muá»™n",
              "vá» sá»›m",
              "khÃ´ng Ä‘á»§ cÃ´ng",
              "bá»‹ trá»« giá»",
              "bá»‹ trá»« cÃ´ng",
              "Ä‘i trá»…",
              "hÃ´m nay",
              "hÃ´m qua",
              "hÃ´m trÆ°á»›c",
              "hÃ´m kia",
              "ngÃ y X (cá»¥ thá»ƒ: 10/7, 1/8, 10, 12, 15, v.v.)",
              "thá»© X (thá»© 2, thá»© 3, thá»© 4, thá»© 5, thá»© 7, v.v.)",
              "tuáº§n nÃ y",
              "tuáº§n trÆ°á»›c",
              "tuáº§n trÆ°á»›c ná»¯a",
              "tuáº§n vá»«a rá»“i",
              "thÃ¡ng nÃ y",
              "thÃ¡ng vá»«a rá»“i",
              "thÃ¡ng trÆ°á»›c",
              "Ä‘áº§u tuáº§n",
              "Ä‘áº§u thÃ¡ng",
              "tá»« ngÃ y X Ä‘áº¿n ngÃ y Y",
              "tÃ´i Ä‘Ã£ â€¦ chÆ°a",
              "tÃ´i â€¦ lÃºc nÃ o",
              "lÃ  lÃºc nÃ o",
              "thÃ¬ sao",
              "tháº¿ nÃ o",
              "trong khoáº£ng thá»i gian Ä‘Ã³",
              "giá» cÃ´ng",
              "ngÃ y cÃ´ng"
            ]
          },
          {
            "topic": "off_topic",
            "phrases": [
              "lÃ m thÆ¡",
              "viáº¿t code"
            ],
            "keywords": [
              "lÃ m thÆ¡",
              "viáº¿t code"
            ]
          }
        ]
      },
      "name": "Router"
    },
    {
      "id": "b11ef36f209327bd8fe76de7a1e3629a",
      "type": "flowSwitch",
      "componentType": "switch",
      "properties": {
        "conditions": {
          "greetings": "greetings",
          "off_topic": "off_topic",
          "attendance": "attendance"
        }
      },
      "branches": {
        "greetings": [
          {
            "id": "d33e8281a8ae7b05b54ded0fe85b75db",
            "type": "botSendText",
            "componentType": "task",
            "properties": {
              "text": "ChÃ o báº¡n ğŸ‘‹ Attendance Bot cÃ³ thá»ƒ giÃºp báº¡n tra cá»©u thá»i gian check-in/check-out, thÃ´ng tin vi pháº¡m, v.v.\nVÃ­ dá»¥, báº¡n cÃ³ thá»ƒ há»i:\n- thá»i gian check in, check out cá»§a tÃ´i thá»© 4 vá»«a rá»“i?\n- thá»© 4 vá»«a rá»“i tÃ´i cÃ³ vi pháº¡m gÃ¬ khÃ´ng?\n- ngÃ y 25/08 tÃ´i cÃ³ Ä‘i muá»™n khÃ´ng?\n\nğŸ’¡ Äá»ƒ káº¿t quáº£ chÃ­nh xÃ¡c nháº¥t, báº¡n nÃªn Ä‘áº·t cÃ¢u há»i theo cÃ¡c vÃ­ dá»¥ máº«u bÃªn trÃªn.\n\nğŸ” HÃ´m nay báº¡n muá»‘n tra cá»©u thÃ´ng tin gÃ¬?"
            },
            "name": "Bot Send Text"
          },
          {
            "id": "6d174a7d6a49713a3aca4f6dee7b567a",
            "type": "clearTopic",
            "componentType": "task",
            "properties": {},
            "name": "Clear Topic"
          }
        ],
        "off_topic": [
          {
            "id": "e9dc59fd932a7c7554bc9551f030137c",
            "type": "botSendText",
            "componentType": "task",
            "properties": {
              "text": "Xin lá»—i, Attendance Bot khÃ´ng thá»ƒ tráº£ lá»i cÃ¢u há»i cá»§a báº¡n."
            },
            "name": "Bot Send Text"
          },
          {
            "id": "1482f59b6d490c4c742ffb7384ed9d76",
            "type": "clearTopic",
            "componentType": "task",
            "properties": {},
            "name": "Clear Topic"
          }
        ],
        "attendance": [
          {
            "id": "dd0378f6e848991df0759b8fc8a5338e",
            "type": "botAPICall",
            "componentType": "task",
            "properties": {
              "api_response_var_name": "api_session",
              "api_url": "https://api.cmcts.cloud/api/attendance-bot/session/{{ user_id }}",
              "api_body": "",
              "api_header": "{\n    \"Content-Type\": \"application/json\"\n}",
              "api_method": "GET"
            },
            "name": "Bot API Call"
          },
          {
            "id": "dbcc6a3ce89fb85d9d8bb73aec8f78dc",
            "type": "qna",
            "componentType": "task",
            "properties": {
              "instruction": "# YÃªu cáº§u\nDá»±a vÃ o ngá»¯ cáº£nh hiá»‡n táº¡i, hÃ£y xÃ¡c Ä‘á»‹nh xem ngÆ°á»i dÃ¹ng Ä‘ang há»i vá» thÃ´ng tin cá»§a chÃ­nh há» hay há»i vá» ngÆ°á»i khÃ¡c.\n\n# Ngá»¯ cáº£nh hiá»‡n táº¡i:\n- TÃªn ngÆ°á»i dÃ¹ng: {{ api_session.data.user_name }}\n- Email ngÆ°á»i dÃ¹ng: {{ api_session.data.user_email }}\n\n# CÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: \n{{ raw_user_input }}\n\n# Quy táº¯c xÃ¡c Ä‘á»‹nh:\n- Náº¿u cÃ¢u há»i khÃ´ng chá»©a tÃªn hoáº·c email khÃ¡c vá»›i {{ api_session.data.user_name }} vÃ  {{ api_session.data.user_email }} thÃ¬ dÃ¹ cÃ³ hay khÃ´ng xuáº¥t hiá»‡n Ä‘áº¡i tá»« nhÃ¢n xÆ°ng â€œtÃ´iâ€, â€œcá»§a tÃ´iâ€, â€œmÃ¬nhâ€,â€¦ váº«n xÃ¡c Ä‘á»‹nh lÃ  NgÆ°á»i dÃ¹ng Ä‘ang há»i vá» chÃ­nh mÃ¬nh.\n- Náº¿u cÃ¢u há»i cÃ³ chá»©a tÃªn hoáº·c email khÃ¡c vá»›i {{ api_session.data.user_name }} vÃ  {{ api_session.data.user_email }}, hoáº·c Ä‘á» cáº­p Ä‘áº¿n má»™t ngÆ°á»i khÃ¡c trong ngá»¯ cáº£nh. VÃ­ dá»¥: â€œgiÃºp tÃ´i xem Ä‘iá»ƒm danh cá»§a Nguyá»…n VÄƒn Aâ€, â€œcheck in cá»§a tÃ´i vÃ o ngÃ y sinh nháº­t cá»§a báº¡n tÃ´iâ€, â€œemail cá»§a anh B cÃ³ thá»i gian check in lÃ  lÃºc nÃ oâ€â€¦ ThÃ¬ xÃ¡c Ä‘á»‹nh lÃ  NgÆ°á»i dÃ¹ng Ä‘ang há»i vá» ngÆ°á»i khÃ¡c.\n\n# YÃªu cáº§u Ä‘áº§u ra\n- Sau khi hoÃ n táº¥t cÃ¡c bÆ°á»›c phÃ¢n tÃ­ch trÃªn, hÃ£y tráº£ vá» DUY NHáº¤T má»™t chuá»—i (string) há»£p lá»‡, khÃ´ng kÃ¨m báº¥t ká»³ vÄƒn báº£n hay chÃº thÃ­ch nÃ o khÃ¡c. GiÃ¡ trá»‹ tráº£ vá» chá»‰ Ä‘Æ°á»£c phÃ©p lÃ  má»™t trong hai:\n    - \"Yes\" â†’ náº¿u xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng Ä‘ang há»i vá» ngÆ°á»i khÃ¡c (out of scope).\n    - \"No\" â†’ náº¿u xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng Ä‘ang há»i vá» chÃ­nh há» (khÃ´ng out of scope).\n",
              "dataset_uuid": "",
              "dataset_qa_uuid": "",
              "rag_query": "",
              "limit": "2",
              "api_key": "",
              "knowledge": "{{ knowledge_from_rag }}",
              "knowledge_aware": false,
              "chat_history_aware": false,
              "human_input_aware": false,
              "varReply": "out_of_scope",
              "temperature": "0.7",
              "max_tokens": "10000",
              "stop": "",
              "stop_regex": "",
              "pattern": "",
              "json_mode": false,
              "multimodal_mode": false,
              "tools": "",
              "agent_loop": false,
              "llm_alt_model": "gpt-4o-mini"
            },
            "name": "AI GPT-4o Self-Query handler"
          },
          {
            "id": "6a498b96a6a6f85ae2e0b55b6cfe95f3",
            "type": "if",
            "componentType": "switch",
            "properties": {
              "condition": "out_of_scope == \"No\""
            },
            "branches": {
              "true": [
                {
                  "id": "e077ad91a332a949f8f028d8702ca6ac",
                  "type": "qna",
                  "componentType": "task",
                  "properties": {
                    "instruction": "Dá»±a vÃ o ngá»¯ cáº£nh hiá»‡n táº¡i, viáº¿t láº¡i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng náº¿u cáº§n thiáº¿t Ä‘á»ƒ Ä‘áº£m báº£o sao cho cÃ¢u há»i Ä‘Æ°á»£c Ä‘áº§y Ä‘á»§ cáº£ thÃ´ng tin vá» thá»i gian vÃ  má»¥c Ä‘Ã­ch.\n\nNgá»¯ cáº£nh hiá»‡n táº¡i:\n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }}\n- Khoáº£ng thá»i gian mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n:\n{{ api_session.data.time_query_str }}\n- Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n: {{ api_session.data.topic }}\n- CÃ¢u há»i trÆ°á»›c Ä‘Ã³ cá»§a ngÆ°á»i dÃ¹ng: {{ api_session.data.prev_question }}\n- CÃ¢u tráº£ lá»i cho cÃ¢u há»i trÆ°á»›c Ä‘Ã³: \n{{ api_session.data.prev_answer }}\n\nCÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: {{ raw_user_input }}\n\nQuy táº¯c xá»­ lÃ½:\n1. Náº¿u cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘áº§y Ä‘á»§ cáº£ thá»i gian vÃ  má»¥c Ä‘Ã­ch tá»« cÃ¢u há»i hiá»‡n táº¡i hoáº·c ngá»¯ cáº£nh trÆ°á»›c Ä‘Ã³ â†’ viáº¿t láº¡i cÃ¢u há»i má»™t cÃ¡ch rÃµ rÃ ng, tá»± nhiÃªn.\n2. Náº¿u khÃ´ng thá»ƒ viáº¿t láº¡i Ä‘áº§y Ä‘á»§ (thiáº¿u cáº£ thá»i gian láº«n má»¥c Ä‘Ã­ch, hoáº·c mÆ¡ há»“ khÃ´ng cÃ³ cÃ¡ch bá»• sung) â†’ tráº£ vá» chuá»—i \"No\".\n\nLÆ°u Ã½: Theo quy Ä‘á»‹nh cá»§a cÃ´ng ty thÃ¬ 1 thÃ¡ng Ä‘Æ°á»£c hiá»ƒu lÃ  tá»« ngÃ y 25 cá»§a thÃ¡ng nÃ y Ä‘áº¿n ngÃ y 26 cá»§a thÃ¡ng sau, chá»© khÃ´ng pháº£i tá»« ngÃ y 1 Ä‘áº¿n ngÃ y cuá»‘i thÃ¡ng.\n\nVÃ­ dá»¥:\nUser: \"Trong thÃ¡ng 8 tÃ´i cÃ³ bao nhiÃªu ngÃ y Ä‘i muá»™n?\"\nOutput: \"Trong thÃ¡ng 8 (tá»« ngÃ y 25/07 Ä‘áº¿n ngÃ y 26/08) tÃ´i cÃ³ bao nhiÃªu ngÃ y Ä‘i muá»™n?\"\n\nUser: \"HÃ´m qua thÃ¬ sao?\"  \nOutput: \"HÃ´m qua tÃ´i check in lÃºc máº¥y giá»?\"\n\nUser: \"Tháº¿ cÃ³ bá»‹ tÃ­nh Ä‘i muá»™n khÃ´ng?\" (ngá»¯ cáº£nh trÆ°á»›c Ä‘Ã³: Ä‘Ã£ há»i vá» tuáº§n trÆ°á»›c)  \nOutput: \"Trong tuáº§n trÆ°á»›c tÃ´i cÃ³ bá»‹ tÃ­nh Ä‘i muá»™n khÃ´ng?\"\n\nUser: \"NgÃ y 10/8 tÃ´i Ä‘i lÃ m lÃºc nÃ o?\"  \nOutput: \"NgÃ y 10/8 tÃ´i Ä‘i lÃ m lÃºc nÃ o?\"\n\nUser: \"CÃ²n hÃ´m Ä‘Ã³ thÃ¬ tháº¿ nÃ o?\" (khÃ´ng cÃ³ ngá»¯ cáº£nh trÆ°á»›c)  \nOutput: \"No\"",
                    "dataset_uuid": "",
                    "dataset_qa_uuid": "",
                    "rag_query": "",
                    "limit": "2",
                    "api_key": "",
                    "knowledge": "{{ knowledge_from_rag }}",
                    "knowledge_aware": false,
                    "chat_history_aware": false,
                    "human_input_aware": true,
                    "varReply": "user_input",
                    "temperature": "0.7",
                    "max_tokens": "16000",
                    "stop": "",
                    "stop_regex": "",
                    "pattern": "",
                    "json_mode": false,
                    "multimodal_mode": false,
                    "tools": "",
                    "agent_loop": false,
                    "llm_alt_model": "gpt-4o-mini"
                  },
                  "name": "AI GPT-4o Rewrite Question"
                },
                {
                  "id": "deaf394e0e968384c98d2769ba340abe",
                  "type": "if",
                  "componentType": "switch",
                  "properties": {
                    "condition": "user_input != \"No\""
                  },
                  "branches": {
                    "true": [
                      {
                        "id": "da014f6068714de6cd47384c4ec52153",
                        "type": "qna",
                        "componentType": "task",
                        "properties": {
                          "instruction": "Dá»±a vÃ o ngá»¯ cáº£nh hiá»‡n táº¡i, hÃ£y phÃ¢n tÃ­ch cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng Ä‘á»ƒ Ä‘Æ°a ra pháº£n há»“i phÃ¹ há»£p. \n\nNgá»¯ cáº£nh hiá»‡n táº¡i: \n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }} \nCÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: {{ user_input }} \n\nQuy táº¯c xá»­ lÃ­ tuáº§n tá»±: (Pháº£i thá»±c hiá»‡n tuáº§n tá»± cÃ¡c bÆ°á»›c tá»« 1 Ä‘áº¿n 4, khÃ´ng Ä‘Æ°á»£c bá» qua hoáº·c hoÃ¡n Ä‘á»•i thá»© tá»±. Chá»‰ khi hoÃ n táº¥t bÆ°á»›c trÆ°á»›c Ä‘Ã³ thÃ¬ má»›i Ä‘Æ°á»£c chuyá»ƒn sang bÆ°á»›c tiáº¿p theo.) \n\n1. Nháº­n diá»‡n thÃ´ng tin thá»i gian trong cÃ¢u há»i \n- Náº¿u ngÆ°á»i dÃ¹ng cÃ³ Ä‘á» cáº­p Ä‘áº¿n thÃ´ng tin thá»i gian bao gá»“m ngÃ y, thÃ¡ng, nÄƒm, tuáº§n, hoáº·c cÃ¡c tá»« khÃ³a chá»‰ má»‘c thá»i gian cá»¥ thá»ƒ hoáº·c tÆ°Æ¡ng Ä‘á»‘i nhÆ°: \n    - â€œhÃ´m nayâ€, â€œngÃ y maiâ€, â€œhÃ´m quaâ€ - â€œthá»© 3 vá»«a quaâ€, â€œthá»© 3 tuáº§n nÃ yâ€, â€œhÃ´m thá»© 3â€, â€œhÃ´m thá»© 3 vá»«a rá»“iâ€ - â€œtuáº§n nÃ yâ€, â€œthÃ¡ng trÆ°á»›câ€, â€œquÃ½ nÃ yâ€ \n    - â€œngÃ y 1/8â€, â€œthÃ¡ng 7â€, â€œnÄƒm 2025â€ - â€œlÃºc 8 giá»â€, â€œ9h sÃ¡ngâ€, â€œchiá»u nayâ€ \n    - â€œtrong 3 ngÃ y gáº§n Ä‘Ã¢yâ€, â€œ7 ngÃ y quaâ€, â€œcuá»‘i tuáº§nâ€ - â€œthÃ¡ng [sá»‘] nÃ yâ€, â€œthÃ¡ng nÃ yâ€, â€œthÃ¡ng vá»«a rá»“iâ€, â€œthÃ¡ng vá»«a quaâ€ \nthÃ¬ chuyá»ƒn sang **BÆ°á»›c 2** \n\n2. XÃ¡c Ä‘á»‹nh loáº¡i thá»i gian trong cÃ¢u há»i \n- Má»™t ngÃ y cá»¥ thá»ƒ (1 cáº·p start_date, end_date vá»›i start_date = end_date). \n    - VÃ­ dá»¥: \n        - HÃ´m nay tÃ´i check-in chÆ°a? \n        - NgÃ y 10 thÃ¡ng 7 tÃ´i vÃ o lÃ m máº¥y giá»? \n        - Giá» check out hÃ´m kia lÃ  lÃºc nÃ o? \n        - Thá»© 3 tuáº§n trÆ°á»›c tÃ´i check in lÃºc nÃ o? \n        - Thá»© 5 tuáº§n trÆ°á»›c ná»¯a tÃ´i check out máº¥y giá»? \nhoáº·c cÃ³ chá»©a cÃ¡c cá»¥m tá»« gá»£i Ã½ má»™t ngÃ y cá»¥ thá»ƒ, nhÆ°: \"hÃ´m nay\", \"hÃ´m qua\", \"hÃ´m kia\", \"hÃ´m trÆ°á»›c\", \"ngÃ y [sá»‘]\", \"ngÃ y [sá»‘] thÃ¡ng [sá»‘]\", \"thá»© 2 tuáº§n trÆ°á»›c\", \"thá»© 6 vá»«a rá»“i\", \"thá»© 4 tuáº§n nÃ y\", \"thá»© 3 vá»«a qua\" v.v. \n- Má»™t khoáº£ng thá»i gian cá»¥ thá»ƒ (1 cáº·p start_date, end_date vá»›i start_date khÃ¡c end_date). \n    - VÃ­ dá»¥: \n        - â€œTrong thÃ¡ng 6 tÃ´i Ä‘i lÃ m máº¥y giá» má»—i ngÃ y?â€ \n        - â€œTá»« ngÃ y 3/8 Ä‘áº¿n 18/8 tÃ´i cÃ³ Ä‘i lÃ m Ä‘áº§y Ä‘á»§ khÃ´ng?â€ \n        - Trong thÃ¡ng 6 tÃ´i Ä‘i lÃ m máº¥y giá» má»—i ngÃ y? \n        - Thá»i gian check-in cá»§a tÃ´i tuáº§n vá»«a rá»“i? \n        - CÃ³ ngÃ y nÃ o trong 2 tuáº§n vá»«a rá»“i tÃ´i quÃªn cháº¥m cÃ´ng khÃ´ng? \n        - Tá»« ngÃ y 3/8 Ä‘áº¿n 18/8 tÃ´i cÃ³ Ä‘i lÃ m Ä‘áº§y Ä‘á»§ khÃ´ng? \n        - ThÃ¡ng nÃ y tÃ´i Ä‘i muá»™n bao nhiÃªu buá»•i? \nhoáº·c chá»©a cÃ¡c cá»¥m tá»« thá»ƒ hiá»‡n khoáº£ng thá»i gian, nhÆ°: â€œtrong tuáº§n trÆ°á»›câ€, â€œtrong thÃ¡ng nÃ yâ€, â€œ2 tuáº§n vá»«a rá»“iâ€, \"tuáº§n vá»«a rá»“i\", \"tuáº§n vá»«a qua\", â€œtá»« ngÃ y ... Ä‘áº¿n ngÃ y ...â€, â€œtá»« thá»© 2 Ä‘áº¿n thá»© 6â€, â€œtá»« Ä‘áº§u tuáº§n Ä‘áº¿n nayâ€, â€œtá»« Ä‘áº§u tuáº§n nÃ y Ä‘áº¿n nayâ€, â€œtá»« Ä‘áº§u tuáº§n trÆ°á»›c Ä‘áº¿n nayâ€, â€œtá»« Ä‘áº§u tuáº§n vá»«a rá»“i Ä‘áº¿n nayâ€, v.v. \n- Nhiá»u khoáº£ng/má»‘c thá»i gian cá»¥ thá»ƒ (nhiá»u cáº·p start_date, end_date). \n    - Khi trong cÃ¢u há»i xuáº¥t hiá»‡n tá»« 2 má»‘c trá»Ÿ lÃªn hoáº·c nhiá»u khoáº£ng thá»i gian Ä‘Æ°á»£c ná»‘i báº±ng cÃ¡c tá»« liÃªn káº¿t nhÆ° â€œvÃ â€, â€œhoáº·câ€, â€œcÅ©ng nhÆ°â€. \n    - VÃ­ dá»¥: \n        - CÃ¢u \"MÃ¹ng 10, 12, 15 thÃ¡ng trÆ°á»›c tÃ´i check in lÃºc nÃ o?\" cÃ³ 3 ngÃ y cá»¥ thá»ƒ \n        - CÃ¢u \"CÃ¡c ngÃ y 10, 12, 15 cá»§a thÃ¡ng vá»«a rá»“i tÃ´i cÃ³ Ä‘i muá»™n khÃ´ng?\" cÃ³ 3 ngÃ y cá»¥ thá»ƒ \n        - CÃ¢u \"NgÃ y 10, 12, 15 thÃ¡ng vá»«a qua tÃ´i cÃ³ Ä‘Æ°á»£c tÃ­nh Ä‘á»§ ngÃ y cÃ´ng khÃ´ng?\" cÃ³ 3 ngÃ y cá»¥ thá»ƒ \n        - CÃ¢u \"Tá»« ngÃ y 1 Ä‘áº¿n 5 vÃ  tá»« ngÃ y 10 Ä‘áº¿n 12 tÃ´i cÃ³ Ä‘i lÃ m Ä‘áº§y Ä‘á»§ khÃ´ng\" cÃ³ 2 khoáº£ng thá»i gian cá»¥ thá»ƒ \n    - LÆ°u Ã½: Vá»›i má»—i khoáº£ng/má»‘c thá»i gian, cáº§n láº·p láº¡i **BÆ°á»›c 3 - TÃ­nh khoáº£ng thá»i gian** Ä‘á»ƒ tÃ­nh start_date vÃ  end_date riÃªng. \n- Sau khi xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c loáº¡i thá»i gian thÃ¬ chuyá»ƒn sang **BÆ°á»›c 3** \n\n3. TÃ­nh khoáº£ng thá»i gian \n- Cho 1 ngÃ y cá»¥ thá»ƒ \n    - Nháº­n diá»‡n cÃ¡c cá»¥m tá»« mÃ´ táº£ ngÃ y cá»¥ thá»ƒ, bao gá»“m: \n        - \"hÃ´m qua\", \"hÃ´m nay\", \"hÃ´m trÆ°á»›c\", \"hÃ´m kia\", \"hÃ´m kÃ¬a\" \n        - \"ngÃ y 5\", \"mÃ¹ng 3\" - \"thá»© 2\", \"thá»© ba tuáº§n trÆ°á»›c\", \"thá»© nÄƒm tuáº§n nÃ y\" \n        - \"ngÃ y 15 thÃ¡ng 6\", \"ngÃ y 2 thÃ¡ng trÆ°á»›c\", v.v. \n    - Giáº£i thÃ­ch cÃ¡c cá»¥m thá»i gian tÆ°Æ¡ng Ä‘á»‘i dá»±a trÃªn current_date: \n        - â€œhÃ´m nayâ€ â†’ chÃ­nh lÃ  current_date \n        - â€œhÃ´m quaâ€ â†’ current_date - 1 ngÃ y \n        - â€œhÃ´m trÆ°á»›câ€ â†’ current_date - 2 ngÃ y \n        - â€œhÃ´m kiaâ€ â†’ current_date \n        - 2 ngÃ y - â€œhÃ´m kÃ¬aâ€ â†’ current_date \n        - 3 ngÃ y - â€œthá»© [x] tuáº§n nÃ yâ€ â†’ ngÃ y gáº§n nháº¥t á»©ng vá»›i thá»© Ä‘Ã³ trong cÃ¹ng tuáº§n vá»›i current_date \n        - â€œthá»© [x] tuáº§n trÆ°á»›câ€ â†’ ngÃ y tÆ°Æ¡ng á»©ng vá»›i thá»© Ä‘Ã³ cá»§a tuáº§n trÆ°á»›c (tuáº§n gáº§n nháº¥t Ä‘Ã£ káº¿t thÃºc) \n        - â€œngÃ y [sá»‘]â€ hoáº·c â€œmÃ¹ng [sá»‘]â€ â†’ cÃ¹ng thÃ¡ng vá»›i current_date \n        - â€œngÃ y [sá»‘] thÃ¡ng [sá»‘]â€ â†’ sá»­ dá»¥ng nÄƒm cá»§a current_date, trá»« khi ngÆ°á»i dÃ¹ng nÃ³i rÃµ nÄƒm \n        - â€œngÃ y [sá»‘] thÃ¡ng trÆ°á»›câ€ â†’ ngÃ y tÆ°Æ¡ng á»©ng cá»§a thÃ¡ng trÆ°á»›c \n        - â€œngÃ y [sá»‘] thÃ¡ng nÃ yâ€ â†’ ngÃ y tÆ°Æ¡ng á»©ng cá»§a thÃ¡ng hiá»‡n táº¡i \n    - VÃ­ dá»¥: \n        - Náº¿u current_date lÃ  2025-03-08 vÃ  ngÆ°á»i dÃ¹ng há»i: â€œTÃ´i check in hÃ´m qua lÃºc máº¥y giá»?â€ thÃ¬ káº¿t quáº£ tÃ­nh toÃ¡n Ä‘Æ°á»£c sáº½ lÃ : current_time: \"2025-03-07\" \n        - Náº¿u ngÆ°á»i dÃ¹ng nÃ³i: â€œNgÃ y 2 thÃ¡ng trÆ°á»›c tÃ´i nghá»‰ phÃ©pâ€ thÃ¬ káº¿t quáº£ tÃ­nh toÃ¡n Ä‘Æ°á»£c sáº½ lÃ : current_time: \"2025-02-02\" \n        - Náº¿u ngÆ°á»i dÃ¹ng nÃ³i: â€œThá»© ba tuáº§n nÃ y tÃ´i Ä‘áº¿n trá»…â€ thÃ¬ káº¿t quáº£ tÃ­nh toÃ¡n Ä‘Æ°á»£c sáº½ lÃ : current_time: \"2025-03-04\" \n- Cho 1 khoáº£ng thá»i gian \n    - Äá»‹nh nghÄ©a chuáº©n\n        - Quy Æ°á»›c vá» tuáº§n lÃ m viá»‡c: Tá»« thá»© Hai Ä‘áº¿n thá»© SÃ¡u\n        - Quy Æ°á»›c vá» thÃ¡ng\n            - ThÃ¡ng hiá»‡n táº¡i: Tá»« ngÃ y 26 cá»§a thÃ¡ng trÆ°á»›c Ä‘áº¿n 25 cá»§a thÃ¡ng hiá»‡n táº¡i\n            - ThÃ¡ng Ä‘Ã£ qua: Tá»« ngÃ y 26 cá»§a thÃ¡ng trÆ°á»›c Ä‘Ã³ Ä‘áº¿n 25 cá»§a thÃ¡ng mÃ  ngÆ°á»i dÃ¹ng muá»‘n há»i\n    - CÃ¡c pattern nháº­n diá»‡n vÃ  xá»­ lÃ½\n        - Pattern 1: Khoáº£ng thá»i gian tuyá»‡t Ä‘á»‘i\n            - Cáº¥u trÃºc: \"tá»« [ngÃ y cá»¥ thá»ƒ] Ä‘áº¿n [ngÃ y cá»¥ thá»ƒ]\"\n            - VÃ­ dá»¥:\n                - \"tá»« ngÃ y 1 Ä‘áº¿n ngÃ y 5\" â†’ start_date: YYYY-MM-01, end_date: YYYY-MM-05 (cÃ¹ng thÃ¡ng vá»›i current_date)\n                - \"tá»« 15 thÃ¡ng trÆ°á»›c Ä‘áº¿n 20 thÃ¡ng nÃ y\" â†’ start_date: (thÃ¡ng trÆ°á»›c)-15, end_date: (thÃ¡ng hiá»‡n táº¡i)-20\n        - Pattern 2: Khoáº£ng thá»i gian theo tuáº§n\n            - CÃ¡c cá»¥m tá»« nháº­n diá»‡n:\n                - \"tuáº§n nÃ y\", \"tuáº§n hiá»‡n táº¡i\"\n                - \"tuáº§n trÆ°á»›c\", \"tuáº§n vá»«a rá»“i\", \"tuáº§n vá»«a qua\"\n                - \"tuáº§n trÆ°á»›c ná»¯a\", \"hai tuáº§n trÆ°á»›c\"\n                - \"X tuáº§n trÆ°á»›c\", \"X tuáº§n vá»«a rá»“i\"\n            - Logic tÃ­nh toÃ¡n tuáº§n:\n                current_week = tuáº§n chá»©a current_date\n                week_offset = sá»‘ tuáº§n cáº§n lÃ¹i vá» quÃ¡ khá»©\n\n                Vá»›i \"tuáº§n nÃ y\":\n                - start_date = thá»© Hai cá»§a current_week\n                - end_date = current_date (náº¿u chÆ°a háº¿t tuáº§n) hoáº·c thá»© SÃ¡u (náº¿u Ä‘Ã£ háº¿t tuáº§n)\n\n                Vá»›i \"tuáº§n trÆ°á»›c\":\n                - target_week = current_week - 1\n                - start_date = thá»© Hai cá»§a target_week  \n                - end_date = thá»© SÃ¡u cá»§a target_week\n\n                Vá»›i \"X tuáº§n trÆ°á»›c\":\n                - target_week = current_week - X\n                - start_date = thá»© Hai cá»§a target_week\n                - end_date = thá»© SÃ¡u cá»§a target_week\n\n                Vá»›i \"X tuáº§n vá»«a rá»“i/qua\":\n                - start_date = thá»© Hai cá»§a (current_week - X)\n                - end_date = thá»© SÃ¡u cá»§a (current_week - 1)\n        - Pattern 3: Khoáº£ng thá»i gian theo thÃ¡ng\n            - CÃ¡c cá»¥m tá»« nháº­n diá»‡n:\n                - \"thÃ¡ng nÃ y\", \"thÃ¡ng hiá»‡n táº¡i\"\n                - \"thÃ¡ng trÆ°á»›c\", \"thÃ¡ng vá»«a rá»“i\"\n                - \"thÃ¡ng [sá»‘]\", \"thÃ¡ng [sá»‘] nÄƒm [nÄƒm]\"\n            - Logic tÃ­nh toÃ¡n:\n                - \"thÃ¡ng nÃ y\": start_date = ngÃ y 1 cá»§a thÃ¡ng hiá»‡n táº¡i, end_date = current_date\n                - \"thÃ¡ng trÆ°á»›c\": start_date = ngÃ y 1 cá»§a thÃ¡ng trÆ°á»›c, end_date = ngÃ y cuá»‘i thÃ¡ng trÆ°á»›c\n                - \"thÃ¡ng [sá»‘]\": sá»­ dá»¥ng nÄƒm hiá»‡n táº¡i náº¿u khÃ´ng chá»‰ Ä‘á»‹nh nÄƒm\n        - Pattern 4: Khoáº£ng thá»i gian theo ngÃ y\n            CÃ¡c cá»¥m tá»« nháº­n diá»‡n:\n                \"X ngÃ y qua\", \"X ngÃ y vá»«a rá»“i\", \"X ngÃ y gáº§n Ä‘Ã¢y\"\n                \"tá»« Ä‘áº§u tuáº§n Ä‘áº¿n nay\"\n                \"tá»« Ä‘áº§u thÃ¡ng Ä‘áº¿n nay\"\n            Logic tÃ­nh toÃ¡n:\n                \"X ngÃ y qua\": start_date = current_date - X, end_date = current_date - 1\n                \"tá»« Ä‘áº§u tuáº§n Ä‘áº¿n nay\": start_date = thá»© Hai tuáº§n hiá»‡n táº¡i, end_date = current_date\n                \"tá»« Ä‘áº§u thÃ¡ng Ä‘áº¿n nay\": start_date = ngÃ y 1 thÃ¡ng hiá»‡n táº¡i, end_date = current_date\n    VÃ­ dá»¥ tÃ­nh toÃ¡n vá»›i current_date = 2025-03-08 (thá»© Báº£y)\n        VÃ­ dá»¥ Pattern 1:\n\n        \"tá»« mÃ¹ng 1 Ä‘áº¿n mÃ¹ng 6\" â†’ start_date: \"2025-03-01\", end_date: \"2025-03-06\"\n        \"tá»« 15 thÃ¡ng trÆ°á»›c Ä‘áº¿n 20 thÃ¡ng nÃ y\" â†’ start_date: \"2025-02-15\", end_date: \"2025-03-20\"\n\n        VÃ­ dá»¥ Pattern 2:\n\n        \"tuáº§n nÃ y\" â†’ start_date: \"2025-03-03\" (thá»© Hai), end_date: \"2025-03-08\" (current_date)\n        \"tuáº§n trÆ°á»›c\" â†’ start_date: \"2025-02-24\" (thá»© Hai), end_date: \"2025-02-28\" (thá»© SÃ¡u)\n        \"hai tuáº§n trÆ°á»›c\" â†’ start_date: \"2025-02-17\" (thá»© Hai), end_date: \"2025-02-21\" (thá»© SÃ¡u)\n        \"hai tuáº§n vá»«a rá»“i\" â†’ start_date: \"2025-02-17\" (thá»© Hai), end_date: \"2025-02-28\" (thá»© SÃ¡u tuáº§n trÆ°á»›c)\n\n        VÃ­ dá»¥ Pattern 3:\n\n        \"thÃ¡ng nÃ y\" â†’ start_date: \"2025-04-26\", end_date: \"2025-04-25\"\n        \"thÃ¡ng trÆ°á»›c\" â†’ start_date: \"2025-03-26\", end_date: \"2025-03-25\"\n\n        VÃ­ dá»¥ Pattern 4:\n\n        \"ba ngÃ y vá»«a qua\" â†’ start_date: \"2025-03-05\", end_date: \"2025-03-07\"\n        \"tá»« Ä‘áº§u tuáº§n Ä‘áº¿n nay\" â†’ start_date: \"2025-03-03\", end_date: \"2025-03-08\"\n        \"tá»« Ä‘áº§u thÃ¡ng Ä‘áº¿n nay\" â†’ start_date: \"2025-03-01\", end_date: \"2025-03-08\"\n\nYÃªu cáº§u Ä‘áº§u ra JSON: \n- Sau khi hoÃ n táº¥t cÃ¡c bÆ°á»›c phÃ¢n tÃ­ch trÃªn, hÃ£y tráº£ vá» DUY NHáº¤T má»™t chuá»—i JSON há»£p lá»‡ (khÃ´ng cÃ³ vÄƒn báº£n giáº£i thÃ­ch, khÃ´ng cÃ³ chÃº thÃ­ch) vá»›i cáº¥u trÃºc sau: \n    - Top-level object cÃ³ cÃ¡c trÆ°á»ng: \n        - \"time_query\": array of objects â€” má»—i object Ä‘áº¡i diá»‡n cho má»™t cáº·p start_date / end_date Ä‘Ã£ nháº­n diá»‡n á»Ÿ BÆ°á»›c 1, 2, 3, 4. \n\n    - Schema cho time_query (má»—i pháº§n tá»­): \n        { \n            \"start_date\": \"YYYY-MM-DD\", \n            \"end_date\": \"YYYY-MM-DD\" \n        } \n\n    - VÃ­ dá»¥ Ä‘áº§u ra há»£p lá»‡: \n        { \n            \"time_query\": [ \n                { \n                    \"start_date\": \"2025-08-07\", \n                    \"end_date\": \"2025-08-07\" \n                } \n            ] \n        } \n\n        { \n            \"time_query\": [ \n                { \n                    \"start_date\": \"2025-07-01\", \n                    \"end_date\": \"2025-07-15\" \n                } \n            ] \n        }\n",
                          "dataset_uuid": "",
                          "dataset_qa_uuid": "",
                          "rag_query": "",
                          "limit": "2",
                          "api_key": "",
                          "knowledge": "",
                          "knowledge_aware": false,
                          "chat_history_aware": false,
                          "human_input_aware": true,
                          "varReply": "time_result",
                          "temperature": "0.7",
                          "max_tokens": "16000",
                          "stop": "",
                          "stop_regex": "",
                          "pattern": "",
                          "json_mode": true,
                          "multimodal_mode": false,
                          "tools": "",
                          "agent_loop": false,
                          "llm_alt_model": "gpt-4o-mini"
                        },
                        "name": "AI GPT-4o Time Query Handler"
                      },
                      {
                        "id": "a848168543313429d9679e2e65c120af",
                        "type": "setVar",
                        "componentType": "task",
                        "properties": {
                          "varName": "time_result_json",
                          "varValue": "json.loads(time_result)"
                        },
                        "name": "Var [time_result_json]"
                      },
                      {
                        "id": "c4f3fbd1829bb9da135aeb29226660a8",
                        "type": "python",
                        "componentType": "task",
                        "properties": {
                          "varName": "check_json",
                          "expression": "def check_keys( json_check, keys ):\n    for key in keys:\n        if key not in json_check:\n            return \"No\"\n    return \"Yes\"\n\nbot_check_json = {{ time_result_json }}\nkeys_to_check = [ \"time_query\" ]\n\nprint( check_keys( bot_check_json, keys_to_check ) )"
                        },
                        "name": "Python"
                      },
                      {
                        "id": "8236c9dfdef07d63c889358eb4c3bb28",
                        "type": "if",
                        "componentType": "switch",
                        "properties": {
                          "condition": "check_json == \"Yes\""
                        },
                        "branches": {
                          "true": [
                            {
                              "id": "2ee2c7be1d5aeb17b9155e566714a076",
                              "type": "qna",
                              "componentType": "task",
                              "properties": {
                                "instruction": "Dá»±a vÃ o ngá»¯ cáº£nh hiá»‡n táº¡i, hÃ£y phÃ¢n tÃ­ch cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng Ä‘á»ƒ Ä‘Æ°a ra pháº£n há»“i phÃ¹ há»£p.\n\nNgá»¯ cáº£nh hiá»‡n táº¡i:\n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }}\n- Khoáº£ng thá»i gian mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n:\n{{ api_session.data.time_query_str }}\n- Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n: {{ api_session.data.topic }}\n- CÃ¢u há»i trÆ°á»›c Ä‘Ã³ cá»§a ngÆ°á»i dÃ¹ng: {{ api_session.data.prev_question }}\n- CÃ¢u tráº£ lá»i cho cÃ¢u há»i trÆ°á»›c Ä‘Ã³: \n{{ api_session.data.prev_answer }}\n- LÆ°u Ã½:\n    - Cáº·p cÃ¢u há»i vÃ  cÃ¢u tráº£ lá»i trÆ°á»›c Ä‘Ã³ chá»‰ mang tÃ­nh cháº¥t tham kháº£o vÃ  chá»‰ sá»­ dá»¥ng náº¿u cÃ¢u há»i hiá»‡n táº¡i yÃªu cáº§u liÃªn káº¿t vá»›i má»‘c thá»i gian Ä‘Ã£ Ä‘Æ°á»£c Ä‘á» cáº­p trong cÃ¢u trÆ°á»›c.\n    - VÃ­ dá»¥:\n        - CÃ¢u 1: â€œTuáº§n vá»«a rá»“i cÃ³ hÃ´m nÃ o tÃ´i Ä‘i muá»™n khÃ´ng?â€\n        - CÃ¢u 2: â€œThá»i gian check in nhá»¯ng ngÃ y Ä‘Ã³?â€\n        â†’ á» cÃ¢u 2, cáº§n láº¥y má»‘c thá»i gian tá»« cÃ¢u tráº£ lá»i cá»§a cÃ¢u 1 (â€œnhá»¯ng ngÃ y Ä‘Ã³â€ = cÃ¡c ngÃ y Ä‘i muá»™n trong tuáº§n vá»«a rá»“i) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh chÃ­nh xÃ¡c khoáº£ng thá»i gian.\n\nCÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: {{ user_input }}\n\nQuy táº¯c xá»­ lÃ­ tuáº§n tá»±: (Pháº£i thá»±c hiá»‡n tuáº§n tá»± cÃ¡c bÆ°á»›c tá»« 1 Ä‘áº¿n 3, khÃ´ng Ä‘Æ°á»£c bá» qua hoáº·c hoÃ¡n Ä‘á»•i thá»© tá»±. Chá»‰ khi hoÃ n táº¥t bÆ°á»›c trÆ°á»›c Ä‘Ã³ thÃ¬ má»›i Ä‘Æ°á»£c chuyá»ƒn sang bÆ°á»›c tiáº¿p theo.)\n\n1. Nháº­n diá»‡n thÃ´ng tin chá»§ Ä‘á» trong cÃ¢u há»i\n- Náº¿u ngÆ°á»i dÃ¹ng cÃ³ Ä‘á» cáº­p Ä‘áº¿n chá»§ Ä‘á» vÃ­ dá»¥ nhÆ°:\n    - â€œHÃ´m qua tÃ´i Ä‘i muá»™n khÃ´ng?â€\n    - â€œThá»i gian check in cá»§a tÃ´i thá»© 4 tuáº§n trÆ°á»›c lÃ  lÃºc nÃ o?â€\n    - â€œTÃ´i Ä‘Æ°á»£c bao nhiÃªu ngÃ y cÃ´ng trong tuáº§n nÃ y?â€\n    - â€œNgÃ y 1/8 tÃ´i cÃ³ bá»‹ Ä‘i muá»™n khÃ´ng?â€\nthÃ¬ xÃ¡c Ä‘á»‹nh CÃ³ Ä‘á» cáº­p Ä‘áº¿n chá»§ Ä‘á» vÃ  chuyá»ƒn sang **BÆ°á»›c 2**\n- Náº¿u ngÆ°á»i dÃ¹ng khÃ´ng Ä‘á» cáº­p Ä‘áº¿n báº¥t ká»³ chá»§ Ä‘á» nÃ o á»Ÿ trÃªn, hoáº·c chá»‰ nÃ³i Ä‘áº¿n thá»i gian chung chung mÃ  khÃ´ng gáº¯n vá»›i chá»§ Ä‘á», vÃ­ dá»¥:\n    - â€œHÃ´m nay thÃ¬ sao?â€\n    - â€œHÃ´m trÆ°á»›c thÃ¬ tháº¿ nÃ o?â€\n    - â€œThá»© 7 tuáº§n trÆ°á»›c thÃ¬ sao?â€\n    - \"Thá»© 2 vá»«a rá»“i thÃ¬ sao?\"\n    - \"Thá»© 3 vá»«a qua thÃ¬ tháº¿ nÃ o\"\n    - \"Thá»© 3 tuáº§n trÆ°á»›c ná»¯a?\"\nthÃ¬ xÃ¡c Ä‘á»‹nh KhÃ´ng Ä‘á» cáº­p Ä‘áº¿n chá»§ Ä‘á» vÃ  chuyá»ƒn sang **BÆ°á»›c 3** luÃ´n\n\n2. XÃ¡c Ä‘á»‹nh chá»§ Ä‘á»:\n- Náº¿u ngÆ°á»i dÃ¹ng há»i vá» thá»i gian check-in / check-out cá»¥ thá»ƒ trong ngÃ y. VÃ­ dá»¥:\n    - HÃ´m qua tÃ´i vÃ o lÃ m lÃºc máº¥y giá»?\n    - NgÃ y 10/7 tÃ´i cháº¥m cÃ´ng máº¥y giá»?\n    - HÃ´m nay tÃ´i cÃ³ quÃªn cháº¥m cÃ´ng khÃ´ng?\n    - Thá»i gian check-in hÃ´m kia cá»§a tÃ´i lÃ  máº¥y giá»?\n    - HÃ´m trÆ°á»›c tÃ´i check out lÃºc nÃ o?\n    - Thá»i gian check in, out cá»§a tÃ´i?\n    - CÃ²n thá»i gian check out thÃ¬ tháº¿ nÃ o?\nthÃ¬ xÃ¡c Ä‘á»‹nh chá»§ Ä‘á» lÃ  \"Thá»i gian Check-in / Check-out\" vÃ  tráº£ vá» luÃ´n, khÃ´ng cáº§n chuyá»ƒn sang **BÆ°á»›c 3**\n- Náº¿u ngÆ°á»i dÃ¹ng há»i vá» thÃ´ng tin vi pháº¡m (bao gá»“m cáº£ Ä‘i muá»™n, vá» sá»›m, vÃ  sá»‘ giá»/phÃºt vi pháº¡m). VÃ­ dá»¥:\n    - ThÃ¡ng trÆ°á»›c tÃ´i Ä‘i muá»™n bao nhiÃªu ngÃ y?\n    - Tuáº§n trÆ°á»›c tÃ´i vá» sá»›m máº¥y láº§n?\n    - Tuáº§n vá»«a rá»“i tÃ´i bá»‹ trá»« bao nhiÃªu phÃºt vÃ¬ Ä‘i trá»…?\n    - TÃ´i cÃ³ bá»‹ tÃ­nh Ä‘i trá»… ngÃ y nÃ o trong tuáº§n trÆ°á»›c khÃ´ng?\n    - Tá»•ng sá»‘ láº§n Ä‘i trá»… cá»§a tÃ´i trong thÃ¡ng 6 lÃ  bao nhiÃªu?\n    - Tá»•ng thá»i gian vi pháº¡m tuáº§n trÆ°á»›c lÃ  bao nhiÃªu?\n    - Thá»i gian vi pháº¡m cá»§a tÃ´i hÃ´m qua?\n    - Váº­y lÃ  cÃ³ bá»‹ tÃ­nh vá» sá»›m khÃ´ng?\n    - Tháº¿ lÃ  cÃ³ bá»‹ coi lÃ  Ä‘i muá»™n khÃ´ng?\n    - Tháº¿ bá»‹ tÃ­nh lÃ  Ä‘i muá»™n khÃ´ng? \n\nthÃ¬ xÃ¡c Ä‘á»‹nh chá»§ Ä‘á» lÃ  \"ThÃ´ng tin vi pháº¡m\" vÃ  tráº£ vá» luÃ´n, khÃ´ng cáº§n chuyá»ƒn sang **BÆ°á»›c 7**\n- Náº¿u ngÆ°á»i dÃ¹ng há»i vá» sá»‘ ngÃ y cÃ´ng hoáº·c viá»‡c Ä‘i lÃ m Ä‘á»§ ngÃ y. VÃ­ dá»¥:\n    - ThÃ¡ng nÃ y tÃ´i cÃ³ bao nhiÃªu ngÃ y cÃ´ng?\n    - TÃ´i Ä‘i lÃ m Ä‘á»§ cÃ´ng trong thÃ¡ng 6 khÃ´ng?\n    - Tá»•ng sá»‘ ngÃ y cÃ´ng cá»§a tÃ´i 2 tuáº§n vá»«a rá»“i lÃ  bao nhiÃªu?\nthÃ¬ xÃ¡c Ä‘á»‹nh chá»§ Ä‘á» lÃ  \"NgÃ y cÃ´ng\" vÃ  tráº£ vá» luÃ´n, khÃ´ng cáº§n chuyá»ƒn sang **BÆ°á»›c 7**\n- LÆ°u Ã½: \n    - Náº¿u trong cÃ¢u há»i vá»«a chá»©a thÃ´ng tin vá» má»™t chá»§ Ä‘á» cá»¥ thá»ƒ (vÃ­ dá»¥: check-in/check-out, vi pháº¡m) vá»«a cÃ³ thÃªm cá»¥m tá»« Ä‘iá»u kiá»‡n lá»c (vÃ­ dá»¥: â€œnhá»¯ng ngÃ y Ä‘á»§ cÃ´ng Ä‘Ã³â€, â€œcÃ¡c ngÃ y Ä‘i muá»™n Ä‘Ã³â€), thÃ¬ **Æ°u tiÃªn xÃ¡c Ä‘á»‹nh chá»§ Ä‘á» chÃ­nh theo cÃ¢u há»i gá»‘c**. \n        - CÃ¡c cá»¥m nhÆ° â€œngÃ y Ä‘á»§ cÃ´ngâ€, â€œngÃ y vi pháº¡mâ€, â€œngÃ y Ä‘i muá»™nâ€ chá»‰ dÃ¹ng Ä‘á»ƒ **giá»›i háº¡n táº­p ngÃ y trong time_query**, khÃ´ng thay Ä‘á»•i topic.\n        - VÃ­ dá»¥:\n            - Vá»›i cÃ¢u há»i: â€œThá»i gian check in, out cá»§a tÃ´i nhá»¯ng ngÃ y Ä‘á»§ cÃ´ng Ä‘Ã³?â€ thÃ¬ Topic = \"Thá»i gian Check-in / Check-out\" vÃ  Time_query = táº­p ngÃ y Ä‘á»§ cÃ´ng Ä‘Ã£ xÃ¡c Ä‘á»‹nh tá»« cÃ¢u trÆ°á»›c\n    - Náº¿u cÃ¢u há»i thuá»™c loáº¡i nguyÃªn nhÃ¢n/giáº£i thÃ­ch (chá»©a tá»« khÃ³a WHY-intent: vÃ¬ sao, táº¡i sao, do Ä‘Ã¢u, nguyÃªn nhÃ¢n, lÃ½ do, â€¦) thÃ¬ Æ°u tiÃªn chá»§ Ä‘á» â€œThÃ´ng tin vi pháº¡mâ€, vÃ¬ má»i nguyÃªn nhÃ¢n dáº«n tá»›i máº¥t cÃ´ng hay sai lá»‡ch Ä‘á»u náº±m á»Ÿ layer â€œvi pháº¡mâ€.\n\n3. Náº¿u khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c chá»§ Ä‘á»:\n- Náº¿u ngá»¯ cáº£nh hiá»‡n táº¡i khÃ´ng cÃ³ thÃ´ng vá» Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n thÃ¬ tráº£ vá» chuá»—i \"KhÃ´ng cÃ³\"\n- Náº¿u ngá»¯ cáº£nh hiá»‡n táº¡i Ä‘Ã£ cÃ³ thÃ´ng tin vá» Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n thÃ¬ Báº®T BUá»˜C pháº£i láº¥y thÃ´ng tin Ä‘Ã³ lÃ m chá»§ Ä‘á».\n\nYÃªu cáº§u Ä‘áº§u ra JSON:\n- Sau khi hoÃ n táº¥t cÃ¡c bÆ°á»›c phÃ¢n tÃ­ch trÃªn, hÃ£y tráº£ vá» DUY NHáº¤T má»™t chuá»—i JSON há»£p lá»‡ (khÃ´ng cÃ³ vÄƒn báº£n giáº£i thÃ­ch, khÃ´ng cÃ³ chÃº thÃ­ch) vá»›i cáº¥u trÃºc sau:\n    - Top-level object cÃ³ cÃ¡c trÆ°á»ng:\n        - \"topic\": string â€” giÃ¡ trá»‹ chá»§ Ä‘á» Ä‘Ã£ nháº­n diá»‡n á»Ÿ BÆ°á»›c 1, 2, 3.\n\n    - VÃ­ dá»¥ Ä‘áº§u ra há»£p lá»‡:\n        {\n            \"topic\": \"Thá»i gian Check-in / Check-out\",\n        }\n\n        {\n            \"topic\": \"NgÃ y cÃ´ng\",\n        }\n",
                                "dataset_uuid": "",
                                "dataset_qa_uuid": "",
                                "rag_query": "",
                                "limit": "2",
                                "api_key": "",
                                "knowledge": "{{ knowledge_from_rag }}",
                                "knowledge_aware": false,
                                "chat_history_aware": false,
                                "human_input_aware": false,
                                "varReply": "topic_result",
                                "temperature": "0.7",
                                "max_tokens": "16000",
                                "stop": "",
                                "stop_regex": "",
                                "pattern": "",
                                "json_mode": false,
                                "multimodal_mode": false,
                                "tools": "",
                                "agent_loop": false,
                                "llm_alt_model": "gpt-4o-mini"
                              },
                              "name": "AI GPT-4o Topic Handler"
                            },
                            {
                              "id": "040f292e598480ae3a06fdf012f24949",
                              "type": "setVar",
                              "componentType": "task",
                              "properties": {
                                "varName": "topic_result_json",
                                "varValue": "json.loads(topic_result)"
                              },
                              "name": "Var [topic_result_json]"
                            },
                            {
                              "id": "553e57aa5a0602efd5ee17a162ca2ada",
                              "type": "python",
                              "componentType": "task",
                              "properties": {
                                "varName": "check_json_1",
                                "expression": "def check_keys( json_check, keys ):\n    for key in keys:\n        if key not in json_check:\n            return \"No\"\n    return \"Yes\"\n\nbot_check_json = {{ topic_result_json }}\nkeys_to_check = [ \"topic\" ]\n\nprint( check_keys( bot_check_json, keys_to_check ) )"
                              },
                              "name": "Python"
                            },
                            {
                              "id": "239429ebcc60972a189a44806452ddff",
                              "type": "if",
                              "componentType": "switch",
                              "properties": {
                                "condition": "check_json_1 == \"Yes\""
                              },
                              "branches": {
                                "true": [
                                  {
                                    "id": "7b22cd44efa55eebfc0fa0b356846a90",
                                    "type": "python",
                                    "componentType": "task",
                                    "properties": {
                                      "varName": "saved_context_data",
                                      "expression": "import json\n\ntime_result_json = {{ time_result_json }}\ntopic_result_json = {{ topic_result_json }}\nuser_id = \"{{ user_id }}\"\n\ndef create_query_data( session_id, time_result_json, topic_result_json ):\n\n    query_data = {\n        \"session_id\": session_id,\n        \"data\": {\n            \"time_query\": time_result_json[ \"time_query\" ],\n            \"topic\": topic_result_json[ \"topic\" ]\n        }\n    }\n    return json.dumps( query_data )\n\nprint( create_query_data( user_id, time_result_json, topic_result_json ) )\n"
                                    },
                                    "name": "Python"
                                  },
                                  {
                                    "id": "beac7729b9ebc4ed502a1c0a0a39199d",
                                    "type": "botAPICall",
                                    "componentType": "task",
                                    "properties": {
                                      "api_response_var_name": "session_upsert_result",
                                      "api_url": "https://api.cmcts.cloud/api/attendance-bot/session/upsert",
                                      "api_body": "{{ saved_context_data }}",
                                      "api_header": "{\n    \"Content-Type\": \"application/json\"\n}",
                                      "api_method": "POST"
                                    },
                                    "name": "Bot API Call"
                                  },
                                  {
                                    "id": "cf91af3d6d1eb117f68bdeb6b62fd2c8",
                                    "type": "if",
                                    "componentType": "switch",
                                    "properties": {
                                      "condition": "time_result_json.time_query != []"
                                    },
                                    "branches": {
                                      "true": [
                                        {
                                          "id": "826ad3be7b9755f95d3231678790e448",
                                          "type": "python",
                                          "componentType": "task",
                                          "properties": {
                                            "varName": "query_data_1",
                                            "expression": "import json\n\ntime_result_json = {{ time_result_json }}\nuser_email = \"{{ api_session.data.user_email }}\"\n\ndef create_query_data( user_email, time_result_json ):\n     time_query = time_result_json[ \"time_query\" ]\n\n     query_data = {\n        \"user_email\": user_email,\n        \"time_query\": time_query\n    }\n     return json.dumps(query_data)\n\nprint( create_query_data( user_email, time_result_json ) )\n"
                                          },
                                          "name": "Python"
                                        },
                                        {
                                          "id": "d6b12ef337b1f082d7fa63d417da5d6a",
                                          "type": "botAPICall",
                                          "componentType": "task",
                                          "properties": {
                                            "api_response_var_name": "check_dayoff_result",
                                            "api_url": "https://api.cmcts.cloud/api/attendance-bot/day-off/check",
                                            "api_body": "{{ query_data_1 }}",
                                            "api_header": "{\"Authorization\": \"Bearer token\"}",
                                            "api_method": "POST"
                                          },
                                          "name": "Bot API Call"
                                        },
                                        {
                                          "id": "18e127a5306cb1e4d9e7975a59fe9eaf",
                                          "type": "python",
                                          "componentType": "task",
                                          "properties": {
                                            "varName": "is_dayoff",
                                            "expression": "check_dayoff_obj = {{ check_dayoff_result }}\n\nprint( check_dayoff_obj[ \"is_dayoff\" ] )"
                                          },
                                          "name": "Python"
                                        },
                                        {
                                          "id": "1056795dbb466ef3bbf1e55ef0173322",
                                          "type": "if",
                                          "componentType": "switch",
                                          "properties": {
                                            "condition": "is_dayoff == \"False\""
                                          },
                                          "branches": {
                                            "true": [
                                              {
                                                "id": "2ac6240196365f1298ece9ea2f3b428a",
                                                "type": "if",
                                                "componentType": "switch",
                                                "properties": {
                                                  "condition": "topic_result_json.topic != 'KhÃ´ng cÃ³'"
                                                },
                                                "branches": {
                                                  "true": [
                                                    {
                                                      "id": "4f11f15fd1f2fb8cc5bb311c256d1211",
                                                      "type": "python",
                                                      "componentType": "task",
                                                      "properties": {
                                                        "varName": "query_data",
                                                        "expression": "import json\n\ntime_result_json = {{ time_result_json }}\nuser_email = \"{{ api_session.data.user_email }}\"\n\ndef create_query_data( user_email, time_result_json ):\n    time_query = time_result_json[ \"time_query\" ]\n\n    query_data = {\n        \"user_email\": user_email,\n        \"time_query\": time_query\n    }\n    return json.dumps(query_data)\n\nprint( create_query_data( user_email, time_result_json ) )\n"
                                                      },
                                                      "name": "Python"
                                                    },
                                                    {
                                                      "id": "c1a564c4274d1cf830aa6d17d642d1f9",
                                                      "type": "parallel",
                                                      "componentType": "switch",
                                                      "properties": {
                                                        "conditions": {
                                                          "Thá»i gian Check-in / Check-out cá»¥ thá»ƒ": "topic_result_json.get( 'topic', 'KhÃ´ng cÃ³' ) == 'Thá»i gian Check-in / Check-out'",
                                                          "NgÃ y cÃ´ng": "topic_result_json.get( 'topic', 'KhÃ´ng cÃ³' ) == 'NgÃ y cÃ´ng'\n",
                                                          "ThÃ´ng tin vi pháº¡m": "topic_result_json.get( 'topic', 'KhÃ´ng cÃ³' ) == 'ThÃ´ng tin vi pháº¡m'"
                                                        }
                                                      },
                                                      "branches": {
                                                        "Thá»i gian Check-in / Check-out cá»¥ thá»ƒ": [
                                                          {
                                                            "id": "b1d19dae23b34ecfef51e86e6f5ffc4e",
                                                            "type": "botAPICall",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "api_response_var_name": "attendance_data",
                                                              "api_url": "https://api.cmcts.cloud/api/attendance-bot/search/time",
                                                              "api_body": "{{ query_data }}",
                                                              "api_header": "{\n    \"Content-Type\": \"application/json\"\n}",
                                                              "api_method": "POST"
                                                            },
                                                            "name": "Bot API Call"
                                                          },
                                                          {
                                                            "id": "ee134ca07be1c26d48b481e071372ec4",
                                                            "type": "python",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "varName": "is_data_empty",
                                                              "expression": "attendance_data = {{ attendance_data }}\n\ndef is_data_empty( attendance_data ):\n    if not attendance_data or \"data\" not in attendance_data or not attendance_data[\"data\"]:\n        return \"Yes\"\n    \n    return \"No\"\n\nprint( is_data_empty( attendance_data ) )\n"
                                                            },
                                                            "name": "Python"
                                                          },
                                                          {
                                                            "id": "fa43022a7b74a3550fbab139e56383ac",
                                                            "type": "if",
                                                            "componentType": "switch",
                                                            "properties": {
                                                              "condition": "is_data_empty == \"Yes\""
                                                            },
                                                            "branches": {
                                                              "true": [
                                                                {
                                                                  "id": "996cad78d578561e432a46ed5cf43ad3",
                                                                  "type": "botSendText",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "text": "Ráº¥t tiáº¿c, Attendance Bot chÆ°a tÃ¬m tháº¥y dá»¯ liá»‡u báº¡n yÃªu cáº§u. Náº¿u Ä‘Ã¢y lÃ  sá»± cá»‘, vui lÃ²ng liÃªn há»‡ vá»›i phÃ²ng nhÃ¢n sá»± Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£."
                                                                  },
                                                                  "name": "Bot Send Text"
                                                                }
                                                              ],
                                                              "false": [
                                                                {
                                                                  "id": "726861095d58707b3f31c510a179cf33",
                                                                  "type": "python",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "varName": "processed_data",
                                                                    "expression": "attendance_data = {{ attendance_data }}\n\ndef process_data( attendance_data ):\n    summary_parts = []\n    summary_parts.append( \"Thá»i gian check in/out:\\n\" )\n\n    for index, record in enumerate( attendance_data[ \"data\" ] ):\n        summary_parts.append( f\"NgÃ y: { record.get( 'date', 'khÃ´ng cÃ³' ) }\" )\n\n        checkin_text = \"check in time: \"\n        checkin_text += record.get( \"checkin_time\" ) or \"khÃ´ng cÃ³\"\n        summary_parts.append( checkin_text )\n\n        checkout_text = \"check out time: \"\n        checkout_text += record.get( \"checkout_time\" ) or \"khÃ´ng cÃ³\"\n        summary_parts.append( checkout_text )\n\n        if index < len( attendance_data[ \"data\" ] ) - 1:\n            summary_parts.append( \"\" )  # dÃ²ng trá»‘ng giá»¯a cÃ¡c báº£n ghi\n\n    final_summary = \"\\n\".join( summary_parts )\n    return final_summary\n\nprint( process_data( attendance_data ) )"
                                                                  },
                                                                  "name": "Python"
                                                                },
                                                                {
                                                                  "id": "90eebd73d425ec71fc7f94288daadb63",
                                                                  "type": "qna",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "instruction": "Vai trÃ²:\n- Báº¡n lÃ  trá»£ lÃ½ tÃªn Minh Hiá»ƒn, trá»£ lÃ½ áº£o chuyÃªn biá»‡t há»— trá»£ há»i Ä‘Ã¡p cháº¥m cÃ´ng. Báº¡n hÃ£y luÃ´n giao tiáº¿p báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Æ°a thÃ­ch vÃ  thÃ­ch á»©ng vá»›i phong cÃ¡ch giao tiáº¿p cá»§a NgÆ°á»i dÃ¹ng.\n- Báº¡n lÃ  chuyÃªn gia giÃ u kiáº¿n thá»©c vá» há»‡ thá»‘ng quáº£n lÃ½ cháº¥m cÃ´ng, cung cáº¥p hÆ°á»›ng dáº«n chuyÃªn sÃ¢u vá» theo dÃµi thá»i gian lÃ m viá»‡c. Báº¡n xuáº¥t sáº¯c trong viá»‡c phÃ¢n tÃ­ch mÃ´ hÃ¬nh cháº¥m cÃ´ng cá»§a ngÆ°á»i dÃ¹ng, nháº­n diá»‡n cÃ¡c váº¥n Ä‘á» tiá»m áº©n vÃ  Ä‘Æ°a ra cÃ¡c giáº£i phÃ¡p hÃ nh Ä‘á»™ng nháº±m cáº£i thiá»‡n quáº£n lÃ½ thá»i gian.\n\n\nKÄ© nÄƒng:\n- Trá»£ lÃ½ thÃ nh tháº¡o trong viá»‡c xá»­ lÃ½ cÃ¡c phÃ©p tÃ­nh cháº¥m cÃ´ng phá»©c táº¡p, phÃ¢n tÃ­ch so sÃ¡nh vÃ  táº¡o cÃ¡c bÃ¡o cÃ¡o cÃ³ Ã½ nghÄ©a. Trá»£ lÃ½ luÃ´n tráº£ lá»i báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng, Ä‘á»“ng thá»i Ä‘iá»u chá»‰nh giá»ng Ä‘iá»‡u vÃ  má»©c Ä‘á»™ chi tiáº¿t sao cho phÃ¹ há»£p vá»›i sá»Ÿ thÃ­ch cá»§a NgÆ°á»i dÃ¹ng.\n\n\nGiá»ng Ä‘iá»‡u:\n- HÃ i hÆ°á»›c vÃ  chÃ¢m biáº¿m Ä‘Ã´i khi khÃ³ truyá»n táº£i qua vÄƒn báº£n, vÃ¬ váº­y hÃ£y giá»¯ ná»™i dung rÃµ rÃ ng, trÃ¡nh gÃ¢y hiá»ƒu láº§m.\n- Ngay cáº£ khi trÃ² chuyá»‡n thÃ¢n máº­t, báº¡n váº«n pháº£i giá»¯ má»©c Ä‘á»™ chuyÃªn nghiá»‡p nháº¥t Ä‘á»‹nh, Ä‘áº£m báº£o tÆ°Æ¡ng tÃ¡c lá»‹ch sá»± vÃ  tÃ´n trá»ng\n\n\nCÃ¡ch xÆ°ng hÃ´ trong Tiáº¿ng Viá»‡t\n- Trong tiáº¿ng Viá»‡t, báº¡n luÃ´n xÆ°ng lÃ  \"em\" trong má»i trÆ°á»ng há»£p.\n- Báº¡n gá»i NgÆ°á»i dÃ¹ng báº±ng danh xÆ°ng lá»‹ch sá»± lÃ  \"anh\" náº¿u giá»›i tÃ­nh lÃ  nam, \"chá»‹\" náº¿u giá»›i tÃ­nh lÃ  ná»¯, vÃ  náº¿u chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh thÃ¬ gá»i lÃ  \"anh/chá»‹\".\n- VÃ­ dá»¥\n    - NgÆ°á»i dÃ¹ng: \"Xin chÃ o\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng nÃ³i \"xin chÃ o\" nhÆ°ng khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh.\n    - Trá»£ lÃ­ áº£o: \"Dáº¡, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh/chá»‹?\"\n    - NgÆ°á»i dÃ¹ng: \"ChÃ o em, anh lÃ  TÃ¹ng, cho anh há»i má»™t chÃºt.\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng xÆ°ng \"anh\" vÃ  giá»›i thiá»‡u tÃªn lÃ  \"TÃ¹ng\", xÃ¡c Ä‘á»‹nh giá»›i tÃ­nh lÃ  nam.\n    - Trá»£ lÃ­ áº£o: \"ChÃ o anh TÃ¹ng, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh?\"\n\n\nNhiá»‡m vá»¥:\n- Dá»±a vÃ o ná»™i dung cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  cÃ¡c thÃ´ng tin ngá»¯ cáº£nh hiá»‡n táº¡i bao gá»“m cÃ¡c thÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n - thÃ´ng tin truy váº¥n tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u, hÃ£y tráº£ lá»i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng.\n\n\nCÃ¡ch tráº£ lá»i:\n- Náº¿u cÃ¢u tráº£ lá»i chá»‰ liÃªn quan Ä‘áº¿n **1 ngÃ y**: \n    - Khi tráº£ lá»i, luÃ´n báº¯t Ä‘áº§u cÃ¢u báº±ng: Dáº¡, [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i], anh/chá»‹ ...\n        - Trong Ä‘Ã³:\n            - KhÃ´ng thÃªm tiá»n tá»‘ hay thÃ´ng tin khÃ¡c trÆ°á»›c cá»¥m \"Dáº¡,\" vÃ  khÃ´ng thay Ä‘á»•i format.\n            - Giá»¯ nguyÃªn cÃ¡ch xÆ°ng hÃ´ â€œanh/chá»‹â€ sau dáº¥u pháº©y vÃ  káº¿t thÃºc cÃ¢u báº±ng \"áº¡\" Ä‘á»ƒ thá»ƒ hiá»‡n sá»± lá»… phÃ©p.\n            - [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i] lÃ  pháº§n Ä‘Æ°á»£c diá»…n giáº£i tá»« cÃ¢u há»i, theo Ä‘Ãºng logic nháº­n diá»‡n vÃ  tÃ­nh toÃ¡n (vÃ­ dá»¥: â€œngÃ y 15 thÃ¡ng nÃ yâ€, â€œtá»« 2025-08-04 Ä‘áº¿n 2025-08-08â€), nhÆ°ng khi hiá»ƒn thá»‹ chá»‰ dÃ¹ng Ä‘á»‹nh dáº¡ng ngÃ y/thÃ¡ng (khÃ´ng thÃªm nÄƒm) hoáº·c thá»© + ngÃ y/thÃ¡ng (vÃ­ dá»¥ \"10/08 (khÃ´ng cÃ³ 2025)\" hoáº·c \"thá»© 2 04/08\")\n    - LuÃ´n nÃªu cáº£ cá»¥m tÆ°Æ¡ng Ä‘á»‘i vÃ  ngÃ y/thÃ¡ng cá»¥ thá»ƒ khi ngÆ°á»i dÃ¹ng dÃ¹ng tá»« nhÆ° \"hÃ´m nay\", \"hÃ´m qua\", \"hÃ´m trÆ°á»›c\", \"ngÃ y hÃ´m trÆ°á»›c\".\n        - Máº«u cho trÆ°á»ng há»£p má»™t ngÃ y:\n            - Dáº¡, hÃ´m qua, ngÃ y 10/08, anh/chá»‹ ... áº¡\n            - Dáº¡, hÃ´m nay, ngÃ y 11/08, anh/chá»‹ ... áº¡\n            - Dáº¡, ngÃ y hÃ´m trÆ°á»›c, 09/08, anh/chá»‹ ... áº¡\n        - Máº«u cho thá»©:\n            - Dáº¡, thá»© 3, 12/08, anh/chá»‹ ... áº¡\n- Náº¿u cÃ¢u tráº£ lá»i liÃªn quan Ä‘áº¿n **nhiá»u ngÃ y**:  \n    - Má»Ÿ Ä‘áº§u má»™t láº§n vá»›i \"Dáº¡, ...\" Ä‘á»ƒ giá»›i thiá»‡u khoáº£ng thá»i gian.  \n    - Sau Ä‘Ã³ xuá»‘ng dÃ²ng, liá»‡t kÃª cÃ¡c ngÃ y theo dáº¡ng danh sÃ¡ch gá»n gÃ ng (bullet points hoáº·c dÃ²ng riÃªng).\n    - KhÃ´ng cáº§n láº·p láº¡i cá»¥m \"Dáº¡,\" á»Ÿ Ä‘áº§u má»—i ngÃ y.\n    - VÃ­ dá»¥ (dá»¯ liá»‡u trong cÃ¢u tráº£ lá»i khÃ´ng Ä‘Ãºng, chá»‰ mang tÃ­nh cháº¥t tham kháº£o):  \n        - Dáº¡, tuáº§n vá»«a rá»“i anh/chá»‹ cÃ³ cÃ¡c thá»i gian check in, out nhÆ° sau áº¡:\n            - 01/08: check in lÃºc 08:09, check out lÃºc 17:25\n            - 04/08: check in lÃºc 08:24, check out lÃºc 17:50\n            - 05/08: check in lÃºc 08:18, check out lÃºc 18:12\n\n\nLÆ°u Ã½:\n- Dá»¯ liá»‡u ngá»¯ cáº£nh cÃ³ thá»ƒ bao gá»“m nhiá»u thÃ´ng tin hÆ¡n so vá»›i ná»™i dung mÃ  ngÆ°á»i dÃ¹ng thá»±c sá»± muá»‘n há»i.\n- Khi tráº£ lá»i, CHá»ˆ ÄÆ¯á»¢C trÃ­ch xuáº¥t Ä‘Ãºng pháº§n thÃ´ng tin phÃ¹ há»£p vá»›i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  bá» qua nhá»¯ng thÃ´ng tin thá»«a.\n    - Náº¿u user há»i vá» check in/out, chá»‰ tráº£ lá»i dá»¯ liá»‡u check in/out.\n\n\nNgá»¯ cáº£nh hiá»‡n táº¡i:\n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }}\n- Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n: {{ api_session.data.topic }}\n- ThÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n:\n{{ processed_data }}\n\n\nCÃ¢u há»i:\n{{ user_input }}",
                                                                    "dataset_uuid": "",
                                                                    "dataset_qa_uuid": "",
                                                                    "rag_query": "",
                                                                    "limit": "2",
                                                                    "api_key": "",
                                                                    "knowledge": "",
                                                                    "knowledge_aware": false,
                                                                    "chat_history_aware": false,
                                                                    "human_input_aware": true,
                                                                    "varReply": "bot_reply",
                                                                    "temperature": "0.7",
                                                                    "max_tokens": "16000",
                                                                    "stop": "",
                                                                    "stop_regex": "",
                                                                    "pattern": "",
                                                                    "json_mode": false,
                                                                    "multimodal_mode": false,
                                                                    "tools": "",
                                                                    "agent_loop": false,
                                                                    "llm_alt_model": "gpt-4o-mini"
                                                                  },
                                                                  "name": "AI GPT-4o Generate Response"
                                                                }
                                                              ]
                                                            },
                                                            "name": "Is data empty?"
                                                          }
                                                        ],
                                                        "NgÃ y cÃ´ng": [
                                                          {
                                                            "id": "a38d92dca86a3b9e480a1bc6039c0e7e",
                                                            "type": "botAPICall",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "api_response_var_name": "attendance_data",
                                                              "api_url": "https://api.cmcts.cloud/api/attendance-bot/search/attendance",
                                                              "api_body": "{{ query_data }}",
                                                              "api_header": "{\n    \"Content-Type\": \"application/json\"\n}",
                                                              "api_method": "POST"
                                                            },
                                                            "name": "Bot API Call"
                                                          },
                                                          {
                                                            "id": "27be30714d63aaa7eda2c6c50626876a",
                                                            "type": "python",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "varName": "is_data_empty",
                                                              "expression": "attendance_data = {{ attendance_data }}\n\ndef is_data_empty( attendance_data ):\n    if not attendance_data or \"data\" not in attendance_data or not attendance_data[\"data\"]:\n        return \"Yes\"\n    \n    return \"No\"\n\nprint( is_data_empty( attendance_data ) )\n"
                                                            },
                                                            "name": "Python"
                                                          },
                                                          {
                                                            "id": "430470ee17f0a74c1812228bb1027137",
                                                            "type": "if",
                                                            "componentType": "switch",
                                                            "properties": {
                                                              "condition": "is_data_empty == \"Yes\""
                                                            },
                                                            "branches": {
                                                              "true": [
                                                                {
                                                                  "id": "bf97da2df3c5b79686f629b3aaec7480",
                                                                  "type": "botSendText",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "text": "Ráº¥t tiáº¿c, Attendance Bot chÆ°a tÃ¬m tháº¥y dá»¯ liá»‡u báº¡n yÃªu cáº§u. Náº¿u Ä‘Ã¢y lÃ  sá»± cá»‘, vui lÃ²ng liÃªn há»‡ vá»›i phÃ²ng nhÃ¢n sá»± Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£."
                                                                  },
                                                                  "name": "Bot Send Text"
                                                                }
                                                              ],
                                                              "false": [
                                                                {
                                                                  "id": "ed4fbb9d8692b1ed79bbcf128185479d",
                                                                  "type": "python",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "varName": "processed_data",
                                                                    "expression": "attendance_data = {{ attendance_data }}\n\ndef process_data(attendance_data):\n    # Khá»Ÿi táº¡o biáº¿n thá»‘ng kÃª\n    total_attendance = 0.0  # Äá»•i thÃ nh float Ä‘á»ƒ tÃ­nh tá»•ng chÃ­nh xÃ¡c\n    full_days = 0\n    partial_days = 0  # Äá»•i tÃªn tá»« half_days thÃ nh partial_days vÃ¬ khÃ´ng chá»‰ cÃ³ 0.5\n    total_working_days = 0\n    total_actual_hours = 0.0  # ThÃªm biáº¿n Ä‘á»ƒ tÃ­nh tá»•ng giá» lÃ m viá»‡c thá»±c táº¿\n    total_deduction_hours = 0.0\n\n    full_day_dates = []\n    partial_day_dates = []  # LÆ°u cáº£ ngÃ y vÃ  há»‡ sá»‘ cÃ´ng tÆ°Æ¡ng á»©ng\n\n    # Xá»­ lÃ½ dá»¯ liá»‡u - duyá»‡t qua tá»«ng báº£n ghi Ä‘á»ƒ tÃ­nh toÃ¡n vÃ  phÃ¢n loáº¡i\n    for record in attendance_data[\"data\"]:\n        working_days = float( record.get(\"workingDays\", 0) )\n        actual_hours = float( record.get(\"actualHours\", 0) )\n        deduction_hours = float( record.get(\"deductionHours\", 0) )\n        date = record.get(\"date\", \"\")\n        \n        # Cá»™ng dá»“n cÃ¡c giÃ¡ trá»‹ tá»•ng\n        total_attendance += working_days\n        total_actual_hours += actual_hours\n        total_deduction_hours += deduction_hours\n        total_working_days += 1\n\n        # PhÃ¢n loáº¡i dá»±a trÃªn há»‡ sá»‘ workingDays\n        # NgÃ y Ä‘á»§ cÃ´ng: workingDays >= 1.0 (hoáº·c gáº§n báº±ng 1.0 do lÃ m trÃ²n sá»‘ thá»±c)\n        if working_days >= 0.99:  # Sá»­ dá»¥ng 0.99 thay vÃ¬ 1.0 Ä‘á»ƒ trÃ¡nh lá»—i lÃ m trÃ²n sá»‘ thá»±c\n            full_days += 1\n            full_day_dates.append(date)\n        # NgÃ y lÃ m má»™t pháº§n: workingDays > 0 nhÆ°ng < 1.0\n        elif working_days > 0:\n            partial_days += 1\n            # LÆ°u cáº£ ngÃ y vÃ  há»‡ sá»‘ cÃ´ng Ä‘á»ƒ hiá»ƒn thá»‹ chi tiáº¿t\n            partial_day_dates.append((date, working_days, actual_hours))\n\n    # Táº¡o ná»™i dung summary vá»›i thÃ´ng tin chi tiáº¿t hÆ¡n\n    summary_parts = []\n    \n    # ThÃ´ng tin tá»•ng quan\n    summary_parts.append(f\"Tá»•ng sá»‘ ngÃ y cÃ´ng: {total_attendance:.3f}\")  # Hiá»ƒn thá»‹ 3 sá»‘ tháº­p phÃ¢n\n    summary_parts.append(\"\")\n    summary_parts.append(f\"Tá»•ng sá»‘ giá» cÃ´ng bá»‹ trá»«: {total_deduction_hours:.3f}\")  # Hiá»ƒn thá»‹ 3 sá»‘ tháº­p phÃ¢n\n    summary_parts.append(\"\")\n    summary_parts.append(f\"Tá»•ng sá»‘ giá» cÃ´ng (giá» lÃ m viá»‡c): {total_actual_hours:.1f} giá»\")\n    summary_parts.append(\"\")\n    \n    # Chi tiáº¿t ngÃ y lÃ m Ä‘á»§ cÃ´ng\n    summary_parts.append(f\"Sá»‘ ngÃ y lÃ m Ä‘á»§ cÃ´ng (â‰¥1.0): {full_days}\")\n    for idx, date in enumerate(full_day_dates, start=1):\n        summary_parts.append(f\"  {idx}. {date}\")\n    summary_parts.append(\"\")\n\n    # Chi tiáº¿t ngÃ y lÃ m má»™t pháº§n cÃ´ng\n    summary_parts.append(f\"Sá»‘ ngÃ y lÃ m má»™t pháº§n cÃ´ng (<1.0): {partial_days}\")\n    for idx, (date, working_days, actual_hours) in enumerate(partial_day_dates, start=1):\n        # Hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t: ngÃ y, há»‡ sá»‘ cÃ´ng, sá»‘ giá» thá»±c táº¿\n        summary_parts.append(f\"  {idx}. {date} - {working_days:.3f} cÃ´ng ({actual_hours}h)\")\n\n    # GhÃ©p thÃ nh chuá»—i káº¿t quáº£\n    final_summary = \"\\n\".join(summary_parts)\n    return final_summary\n\nprint( process_data( attendance_data ) )\n"
                                                                  },
                                                                  "name": "Python"
                                                                },
                                                                {
                                                                  "id": "601b1f4982d7d616152e263a58fae001",
                                                                  "type": "qna",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "instruction": "Vai trÃ²:\n- Báº¡n lÃ  trá»£ lÃ½ tÃªn Minh Hiá»ƒn, trá»£ lÃ½ áº£o chuyÃªn biá»‡t há»— trá»£ há»i Ä‘Ã¡p cháº¥m cÃ´ng. Báº¡n hÃ£y luÃ´n giao tiáº¿p báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Æ°a thÃ­ch vÃ  thÃ­ch á»©ng vá»›i phong cÃ¡ch giao tiáº¿p cá»§a NgÆ°á»i dÃ¹ng.\n- Báº¡n lÃ  chuyÃªn gia giÃ u kiáº¿n thá»©c vá» há»‡ thá»‘ng quáº£n lÃ½ cháº¥m cÃ´ng, cung cáº¥p hÆ°á»›ng dáº«n chuyÃªn sÃ¢u vá» theo dÃµi thá»i gian lÃ m viá»‡c. Báº¡n xuáº¥t sáº¯c trong viá»‡c phÃ¢n tÃ­ch mÃ´ hÃ¬nh cháº¥m cÃ´ng cá»§a ngÆ°á»i dÃ¹ng, nháº­n diá»‡n cÃ¡c váº¥n Ä‘á» tiá»m áº©n vÃ  Ä‘Æ°a ra cÃ¡c giáº£i phÃ¡p hÃ nh Ä‘á»™ng nháº±m cáº£i thiá»‡n quáº£n lÃ½ thá»i gian.\n\n\nKÄ© nÄƒng:\n- Trá»£ lÃ½ thÃ nh tháº¡o trong viá»‡c xá»­ lÃ½ cÃ¡c phÃ©p tÃ­nh cháº¥m cÃ´ng phá»©c táº¡p, phÃ¢n tÃ­ch so sÃ¡nh vÃ  táº¡o cÃ¡c bÃ¡o cÃ¡o cÃ³ Ã½ nghÄ©a. Trá»£ lÃ½ luÃ´n tráº£ lá»i báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng, Ä‘á»“ng thá»i Ä‘iá»u chá»‰nh giá»ng Ä‘iá»‡u vÃ  má»©c Ä‘á»™ chi tiáº¿t sao cho phÃ¹ há»£p vá»›i sá»Ÿ thÃ­ch cá»§a NgÆ°á»i dÃ¹ng.\n\n\nGiá»ng Ä‘iá»‡u:\n- HÃ i hÆ°á»›c vÃ  chÃ¢m biáº¿m Ä‘Ã´i khi khÃ³ truyá»n táº£i qua vÄƒn báº£n, vÃ¬ váº­y hÃ£y giá»¯ ná»™i dung rÃµ rÃ ng, trÃ¡nh gÃ¢y hiá»ƒu láº§m.\n- Ngay cáº£ khi trÃ² chuyá»‡n thÃ¢n máº­t, báº¡n váº«n pháº£i giá»¯ má»©c Ä‘á»™ chuyÃªn nghiá»‡p nháº¥t Ä‘á»‹nh, Ä‘áº£m báº£o tÆ°Æ¡ng tÃ¡c lá»‹ch sá»± vÃ  tÃ´n trá»ng\n\n\nCÃ¡ch xÆ°ng hÃ´ trong Tiáº¿ng Viá»‡t\n- Trong tiáº¿ng Viá»‡t, báº¡n luÃ´n xÆ°ng lÃ  \"em\" trong má»i trÆ°á»ng há»£p.\n- Báº¡n gá»i NgÆ°á»i dÃ¹ng báº±ng danh xÆ°ng lá»‹ch sá»± lÃ  \"anh\" náº¿u giá»›i tÃ­nh lÃ  nam, \"chá»‹\" náº¿u giá»›i tÃ­nh lÃ  ná»¯, vÃ  náº¿u chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh thÃ¬ gá»i lÃ  \"anh/chá»‹\".\n- VÃ­ dá»¥\n    - NgÆ°á»i dÃ¹ng: \"Xin chÃ o\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng nÃ³i \"xin chÃ o\" nhÆ°ng khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh.\n    - Trá»£ lÃ­ áº£o: \"Dáº¡, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh/chá»‹?\"\n    - NgÆ°á»i dÃ¹ng: \"ChÃ o em, anh lÃ  TÃ¹ng, cho anh há»i má»™t chÃºt.\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng xÆ°ng \"anh\" vÃ  giá»›i thiá»‡u tÃªn lÃ  \"TÃ¹ng\", xÃ¡c Ä‘á»‹nh giá»›i tÃ­nh lÃ  nam.\n    - Trá»£ lÃ­ áº£o: \"ChÃ o anh TÃ¹ng, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh?\"\n\n\nNhiá»‡m vá»¥:\n- Dá»±a vÃ o ná»™i dung cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  cÃ¡c thÃ´ng tin ngá»¯ cáº£nh hiá»‡n táº¡i bao gá»“m cÃ¡c thÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n - thÃ´ng tin truy váº¥n tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u, hÃ£y tráº£ lá»i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng.\n\n\nCÃ¡ch tráº£ lá»i:\n- Náº¿u cÃ¢u tráº£ lá»i chá»‰ liÃªn quan Ä‘áº¿n **1 ngÃ y**: \n    - Khi tráº£ lá»i, luÃ´n báº¯t Ä‘áº§u cÃ¢u báº±ng: Dáº¡, [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i], anh/chá»‹ ...\n        - Trong Ä‘Ã³:\n            - KhÃ´ng thÃªm tiá»n tá»‘ hay thÃ´ng tin khÃ¡c trÆ°á»›c cá»¥m \"Dáº¡,\" vÃ  khÃ´ng thay Ä‘á»•i format.\n            - Giá»¯ nguyÃªn cÃ¡ch xÆ°ng hÃ´ â€œanh/chá»‹â€ sau dáº¥u pháº©y vÃ  káº¿t thÃºc cÃ¢u báº±ng \"áº¡\" Ä‘á»ƒ thá»ƒ hiá»‡n sá»± lá»… phÃ©p.\n            - [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i] lÃ  pháº§n Ä‘Æ°á»£c diá»…n giáº£i tá»« cÃ¢u há»i, theo Ä‘Ãºng logic nháº­n diá»‡n vÃ  tÃ­nh toÃ¡n (vÃ­ dá»¥: â€œngÃ y 15 thÃ¡ng nÃ yâ€, â€œtá»« 2025-08-04 Ä‘áº¿n 2025-08-08â€), nhÆ°ng khi hiá»ƒn thá»‹ chá»‰ dÃ¹ng Ä‘á»‹nh dáº¡ng ngÃ y/thÃ¡ng (khÃ´ng thÃªm nÄƒm) hoáº·c thá»© + ngÃ y/thÃ¡ng (vÃ­ dá»¥ \"10/08 (khÃ´ng cÃ³ 2025)\" hoáº·c \"thá»© 2 04/08\")\n    - LuÃ´n nÃªu cáº£ cá»¥m tÆ°Æ¡ng Ä‘á»‘i vÃ  ngÃ y/thÃ¡ng cá»¥ thá»ƒ khi ngÆ°á»i dÃ¹ng dÃ¹ng tá»« nhÆ° \"hÃ´m nay\", \"hÃ´m qua\", \"hÃ´m trÆ°á»›c\", \"ngÃ y hÃ´m trÆ°á»›c\".\n        - Máº«u cho trÆ°á»ng há»£p má»™t ngÃ y:\n            - Dáº¡, hÃ´m qua, ngÃ y 10/08, anh/chá»‹ ... áº¡\n            - Dáº¡, hÃ´m nay, ngÃ y 11/08, anh/chá»‹ ... áº¡\n            - Dáº¡, ngÃ y hÃ´m trÆ°á»›c, 09/08, anh/chá»‹ ... áº¡\n        - Máº«u cho thá»©:\n            - Dáº¡, thá»© 3, 12/08, anh/chá»‹ ... áº¡\n- Náº¿u cÃ¢u tráº£ lá»i liÃªn quan Ä‘áº¿n **nhiá»u ngÃ y**:  \n    - Má»Ÿ Ä‘áº§u má»™t láº§n vá»›i \"Dáº¡, ...\" Ä‘á»ƒ giá»›i thiá»‡u khoáº£ng thá»i gian.  \n    - Sau Ä‘Ã³ xuá»‘ng dÃ²ng, liá»‡t kÃª cÃ¡c ngÃ y theo dáº¡ng danh sÃ¡ch gá»n gÃ ng (bullet points hoáº·c dÃ²ng riÃªng).\n    - KhÃ´ng cáº§n láº·p láº¡i cá»¥m \"Dáº¡,\" á»Ÿ Ä‘áº§u má»—i ngÃ y.\n    - VÃ­ dá»¥ (dá»¯ liá»‡u trong cÃ¢u tráº£ lá»i khÃ´ng Ä‘Ãºng, chá»‰ mang tÃ­nh cháº¥t tham kháº£o):\n        - Dáº¡, tá»« 05/08 Ä‘áº¿n 09/08, anh/chá»‹ cÃ³ cÃ¡c vi pháº¡m Ä‘i muá»™n nhÆ° sau áº¡:\n            - 05/08: Ä‘i muá»™n 10 phÃºt, nhÆ°ng theo quy cháº¿ cÃ´ng ty, thÃ¡ng nÃ y anh/chá»‹ váº«n trong sá»‘ 5 láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng\n            - 07/08: Ä‘i muá»™n 22 phÃºt vÃ  bá»‹ trá»« 1 giá» cÃ´ng\n            - 09/08: Ä‘i muá»™n 8 phÃºt, khÃ´ng bá»‹ trá»« giá» cÃ´ng vÃ¬ váº«n trong sá»‘ láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p\n        - Dáº¡, tá»« 12/08 Ä‘áº¿n 16/08, anh/chá»‹ cÃ³ cÃ¡c vi pháº¡m vá» sá»›m nhÆ° sau áº¡:\n            - 12/08: vá» sá»›m 6 phÃºt, khÃ´ng bá»‹ trá»« giá» cÃ´ng vÃ¬ váº«n trong sá»‘ láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p\n            - 14/08: vá» sá»›m 20 phÃºt vÃ  bá»‹ trá»« 1 giá» cÃ´ng\n            - 15/08: vá» sá»›m 12 phÃºt, nhÆ°ng váº«n trong sá»‘ láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng\n\n\n- Náº¿u ngÆ°á»i dÃ¹ng há»i **riÃªng vá» vi pháº¡m Ä‘i muá»™n**:\n    - Chá»‰ tráº£ lá»i thÃ´ng tin Ä‘i muá»™n (cÃ³ hay khÃ´ng, bao nhiÃªu phÃºt, cÃ³ bá»‹ trá»« giá» cÃ´ng khÃ´ng).\n    - TUYá»†T Äá»I khÃ´ng nháº¯c Ä‘áº¿n viá»‡c vá» sá»›m.\n    - CÃ¢u há»i Ä‘Æ°á»£c tÃ­nh lÃ  há»i riÃªng vá» vi pháº¡m Ä‘i muá»™n:\n        - HÃ´m qua tÃ´i checkin muá»™n khÃ´ng\n        - Tá»« Ä‘áº§u thÃ¡ng tá»›i giá» tÃ´i Ä‘i muá»™n nhá»¯ng hÃ´m nÃ o\n    - VÃ­ dá»¥ 1 (Ä‘Æ°á»£c miá»…n):\n        - CÃ¢u há»i: \"NgÃ y 14/08 tÃ´i cÃ³ Ä‘i muá»™n khÃ´ng?\"\n        - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng há»i cá»¥ thá»ƒ vá» Ä‘i muá»™n. Giáº£ sá»­ thÃ´ng tin: NgÃ y 14/08 Ä‘i muá»™n 12 phÃºt (trá»« 0h).\n        - Tráº£ lá»i: Dáº¡, ngÃ y 14/08, anh/chá»‹ Ä‘i muá»™n 12 phÃºt, nhÆ°ng theo quy cháº¿ cÃ´ng ty, thÃ¡ng nÃ y anh/chá»‹ váº«n trong sá»‘ 5 láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng áº¡.\n    - VÃ­ dá»¥ 2 (bá»‹ trá»«):\n        - CÃ¢u há»i: \"NgÃ y 15/08 tÃ´i cÃ³ Ä‘i muá»™n khÃ´ng?\"\n        - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng há»i cá»¥ thá»ƒ vá» Ä‘i muá»™n. Giáº£ sá»­ thÃ´ng tin: NgÃ y 15/08 Ä‘i muá»™n 18 phÃºt (trá»« 1h).\n        - Tráº£ lá»i: Dáº¡, ngÃ y 15/08, anh/chá»‹ Ä‘i muá»™n 18 phÃºt vÃ  bá»‹ trá»« 1 giá» cÃ´ng áº¡.\n- Náº¿u ngÆ°á»i dÃ¹ng há»i **riÃªng vá» vi pháº¡m vá» sá»›m**:\n    - Chá»‰ tráº£ lá»i thÃ´ng tin vá» sá»›m (cÃ³ hay khÃ´ng, bao nhiÃªu phÃºt, cÃ³ bá»‹ trá»« giá» cÃ´ng khÃ´ng).\n    - TUYá»†T Äá»I khÃ´ng nháº¯c Ä‘áº¿n viá»‡c Ä‘i muá»™n.\n    - CÃ¢u há»i Ä‘Æ°á»£c tÃ­nh lÃ  há»i riÃªng vá» vi pháº¡m vá» sá»›m:\n        - Tuáº§n nÃ y tÃ´i vá» sá»›m nhá»¯ng hÃ´m nÃ o\n    - VÃ­ dá»¥ 1 (Ä‘Æ°á»£c miá»…n):\n        - CÃ¢u há»i: \"NgÃ y 12/08 tÃ´i cÃ³ vá» sá»›m khÃ´ng?\"\n        - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng há»i riÃªng vá» vá» sá»›m. Giáº£ sá»­ thÃ´ng tin: NgÃ y 12/08 vá» sá»›m 10 phÃºt (trá»« 0h).\n        - Tráº£ lá»i: Dáº¡, ngÃ y 12/08, anh/chá»‹ vá» sá»›m 10 phÃºt, nhÆ°ng theo quy cháº¿ cÃ´ng ty, thÃ¡ng nÃ y anh/chá»‹ váº«n trong sá»‘ 5 láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng áº¡.\n    - VÃ­ dá»¥ 2 (bá»‹ trá»«):\n        - CÃ¢u há»i: \"HÃ´m qua tÃ´i cÃ³ vá» sá»›m khÃ´ng?\"\n        - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng há»i riÃªng vá» vá» sá»›m. Giáº£ sá»­ hÃ´m qua (13/08) cÃ³ vi pháº¡m: vá» sá»›m 8 phÃºt (trá»« 1h).\n        - Tráº£ lá»i: Dáº¡, hÃ´m qua, ngÃ y 13/08, anh/chá»‹ vá» sá»›m 8 phÃºt vÃ  bá»‹ trá»« 1 giá» cÃ´ng áº¡.\n\n- Náº¿u ngÆ°á»i dÃ¹ng há»i **chung chung hoáº·c cáº£ hai**:\n    - Tráº£ lá»i Ä‘áº§y Ä‘á»§ cáº£ Ä‘i muá»™n vÃ  vá» sá»›m, Ã¡p dá»¥ng cÃ¡c quy táº¯c Ä‘Ã£ nÃªu (tá»•ng há»£p khi cÃ³ cáº£ 2 trong cÃ¹ng má»™t ngÃ y, quy cháº¿ 5 láº§n vi pháº¡m/thÃ¡ng, sá»‘ giá» cÃ´ng bá»‹ trá»«, v.v.).\n    - VÃ­ dá»¥:\n        - CÃ¢u há»i: \"Tuáº§n trÆ°á»›c tÃ´i cÃ³ vi pháº¡m gÃ¬ khÃ´ng?\"\n        - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng há»i vá» thÃ´ng tin vi pháº¡m nÃªn Ä‘Æ°á»£c hiá»ƒu lÃ  cáº£ viá»‡c Ä‘i muá»™n vÃ  vá» sá»›m vÃ¬ váº­y cáº§n tráº£ lá»i cáº£ Ä‘i muá»™n vÃ  vá» sá»›m cho tá»«ng ngÃ y vi pháº¡m.\n        - VÃ­ dá»¥ thÃ´ng tin:\n            - 13/08: Ä‘i muá»™n 14 phÃºt, vá» sá»›m 8 phÃºt â†’ tá»•ng 22 phÃºt, trá»« 1h\n            - 14/08: vá» sá»›m 8 phÃºt (trá»« 1h)\n            - 15/08: Ä‘i muá»™n 5 phÃºt (trá»« 1h)\n        - Tráº£ lá»i:\n            - Dáº¡, tuáº§n trÆ°á»›c, tá»« 11/08 Ä‘áº¿n 17/08, anh/chá»‹ cÃ³ cÃ¡c vi pháº¡m nhÆ° sau áº¡:\n                - NgÃ y 13/08, anh/chá»‹ Ä‘i muá»™n 14 phÃºt vÃ  vá» sá»›m 8 phÃºt, tá»•ng thá»i gian vi pháº¡m lÃ  22 phÃºt, vÃ  bá»‹ trá»« 1 giá» cÃ´ng\n                - NgÃ y 14/08, anh/chá»‹ khÃ´ng Ä‘i muá»™n nhÆ°ng vá» sá»›m 8 phÃºt vÃ  bá»‹ trá»« 1 giá» cÃ´ng\n                - NgÃ y 15/08, anh/chá»‹ Ä‘i muá»™n 5 phÃºt nhÆ°ng khÃ´ng vá» sá»›m, vÃ  bá»‹ trá»« 1 giá» cÃ´ng\n\n- Náº¿u **khÃ´ng phÃ¡t hiá»‡n vi pháº¡m nÃ o**:\n    - Váº«n Ã¡p dá»¥ng format thá»i gian nhÆ° trÃªn nhÆ°ng vá»›i ná»™i dung: *\"anh/chá»‹ Ä‘Ã£ Ä‘i Ä‘Ãºng giá» vÃ  khÃ´ng cÃ³ vi pháº¡m gÃ¬ Ä‘Ã¢u áº¡.\"*\n    - VÃ­ dá»¥:\n        - Dáº¡, hÃ´m nay, ngÃ y 11/08, anh/chá»‹ Ä‘Ã£ Ä‘i Ä‘Ãºng giá» vÃ  khÃ´ng cÃ³ vi pháº¡m gÃ¬ Ä‘Ã¢u áº¡.\n        - Dáº¡, tuáº§n trÆ°á»›c, tá»« 04/08 Ä‘áº¿n 10/08, anh/chá»‹ Ä‘Ã£ Ä‘i Ä‘Ãºng giá» vÃ  khÃ´ng cÃ³ vi pháº¡m gÃ¬ Ä‘Ã¢u áº¡.\n\n- **LÆ°u Ã½:**  \n    - Náº¿u ngÆ°á»i dÃ¹ng há»i thÃ´ng tin vá» nhiá»u ngÃ y vi pháº¡m trong cÃ¹ng má»™t cÃ¢u há»i (vÃ­ dá»¥ \"tuáº§n trÆ°á»›c tÃ´i cÃ³ vi pháº¡m ngÃ y nÃ o khÃ´ng?\", ...), thÃ¬ tá»«ng ngÃ y vi pháº¡m Ä‘á»u pháº£i Ä‘Æ°á»£c liá»‡t kÃª láº§n lÆ°á»£t, khÃ´ng gá»™p chung trá»« khi Ä‘iá»u nÃ y Ä‘Æ°á»£c Ä‘á» cáº­p Ä‘áº¿n trong cÃ¢u há»i.\n\n    - Náº¿u trong má»™t ngÃ y, **sá»‘ giá» cÃ´ng bá»‹ trá»« > 1** thÃ¬ nghÄ©a lÃ  ngÆ°á»i dÃ¹ng Ä‘Ã£ vÆ°á»£t quÃ¡ sá»‘ láº§n vi pháº¡m Ä‘Æ°á»£c phÃ©p trong thÃ¡ng. Náº¿u **sá»‘ giá» cÃ´ng bá»‹ trá»« = 0** thÃ¬ nghÄ©a lÃ  láº§n vi pháº¡m Ä‘Ã³ váº«n náº±m trong sá»‘ láº§n Ä‘Æ°á»£c miá»…n trong thÃ¡ng, nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng. Trong cáº£ hai trÆ°á»ng há»£p, pháº£i tráº£ lá»i Ä‘Ãºng theo hÆ°á»›ng dáº«n bÃªn dÆ°á»›i, tuyá»‡t Ä‘á»‘i khÃ´ng suy diá»…n hoáº·c bá»‹a thÃªm thÃ´ng tin.\n    \n    - Náº¿u sá»‘ giá» cÃ´ng bá»‹ trá»« = 0 (vÃ­ dá»¥: NgÃ y: 2025-08-13 - Vi pháº¡m: Ä‘i muá»™n 14 phÃºt vÃ  vá» sá»›m 8 phÃºt (trá»« 0h)) láº§n vi pháº¡m Ä‘Æ°á»£c miá»…n, pháº£i tráº£ lá»i theo máº«u â€œ... nhÆ°ng váº«n trong sá»‘ 5 láº§n Ä‘Æ°á»£c phÃ©p nÃªn khÃ´ng bá»‹ trá»« giá» cÃ´ng áº¡â€.\n    - Náº¿u sá»‘ giá» cÃ´ng bá»‹ trá»« > 0 (vÃ­ dá»¥: NgÃ y: 2025-08-13 - Vi pháº¡m: Ä‘i muá»™n 14 phÃºt vÃ  vá» sá»›m 8 phÃºt (trá»« 1h)) láº§n vi pháº¡m KHÃ”NG Ä‘Æ°á»£c miá»…n, pháº£i tráº£ lá»i theo máº«u â€œ... vÃ  bá»‹ trá»« X giá» cÃ´ng áº¡â€.\n\n\nLÆ°u Ã½:\n- Dá»¯ liá»‡u ngá»¯ cáº£nh cÃ³ thá»ƒ bao gá»“m nhiá»u thÃ´ng tin hÆ¡n so vá»›i ná»™i dung mÃ  ngÆ°á»i dÃ¹ng thá»±c sá»± muá»‘n há»i.\n- Khi tráº£ lá»i, CHá»ˆ ÄÆ¯á»¢C trÃ­ch xuáº¥t Ä‘Ãºng pháº§n thÃ´ng tin phÃ¹ há»£p vá»›i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  bá» qua nhá»¯ng thÃ´ng tin thá»«a.\n    - Náº¿u user há»i riÃªng vá» vi pháº¡m Ä‘i muá»™n, chá»‰ tráº£ lá»i thÃ´ng tin Ä‘i muá»™n.\n    - Náº¿u user há»i riÃªng vá» vi pháº¡m vá» sá»›m, chá»‰ tráº£ lá»i thÃ´ng tin vá» sá»›m.\n    - Náº¿u user há»i chung chung vá» vi pháº¡m, thÃ¬ tráº£ lá»i cáº£ Ä‘i muá»™n vÃ  vá» sá»›m.\n\n\nNgá»¯ cáº£nh hiá»‡n táº¡i:\n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }}\n- Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n: {{ api_session.data.topic }}\n- ThÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n:\n{{ processed_data }}\n\n\nCÃ¢u há»i:\n{{ user_input }}",
                                                                    "dataset_uuid": "",
                                                                    "dataset_qa_uuid": "",
                                                                    "rag_query": "",
                                                                    "limit": "2",
                                                                    "api_key": "",
                                                                    "knowledge": "{{ knowledge_from_rag }}",
                                                                    "knowledge_aware": false,
                                                                    "chat_history_aware": true,
                                                                    "human_input_aware": true,
                                                                    "varReply": "bot_reply",
                                                                    "temperature": "0.7",
                                                                    "max_tokens": "1000",
                                                                    "stop": "",
                                                                    "stop_regex": "",
                                                                    "pattern": "",
                                                                    "json_mode": false,
                                                                    "multimodal_mode": false,
                                                                    "tools": "",
                                                                    "agent_loop": false,
                                                                    "llm_alt_model": "gpt-mini"
                                                                  },
                                                                  "name": "AI GPT-4o Generate Response"
                                                                }
                                                              ]
                                                            },
                                                            "name": "Is data empty?"
                                                          }
                                                        ],
                                                        "ThÃ´ng tin vi pháº¡m": [
                                                          {
                                                            "id": "2ec2ce155c34437464f38dea3ef4d8bf",
                                                            "type": "botAPICall",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "api_response_var_name": "attendance_data",
                                                              "api_url": "https://api.cmcts.cloud/api/attendance-bot/search/late",
                                                              "api_body": "{{ query_data }}",
                                                              "api_header": "{\n    \"Content-Type\": \"application/json\"\n}",
                                                              "api_method": "POST"
                                                            },
                                                            "name": "Bot API Call"
                                                          },
                                                          {
                                                            "id": "8b746ea8d6164320ecfdc6cd4ab94284",
                                                            "type": "python",
                                                            "componentType": "task",
                                                            "properties": {
                                                              "varName": "is_data_empty",
                                                              "expression": "attendance_data = {{ attendance_data }}\n\ndef is_data_empty( attendance_data ):\n    if not attendance_data or \"data\" not in attendance_data or not attendance_data[\"data\"]:\n        return \"Yes\"\n    \n    return \"No\"\n\nprint( is_data_empty( attendance_data ) )\n"
                                                            },
                                                            "name": "Python"
                                                          },
                                                          {
                                                            "id": "bd0f1b823cc30260bfbe292b270301e2",
                                                            "type": "if",
                                                            "componentType": "switch",
                                                            "properties": {
                                                              "condition": "is_data_empty == \"Yes\""
                                                            },
                                                            "branches": {
                                                              "true": [
                                                                {
                                                                  "id": "3b46b299a47abeefe03dd245f0ff42d7",
                                                                  "type": "botSendText",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "text": "Ráº¥t tiáº¿c, Attendance Bot chÆ°a tÃ¬m tháº¥y dá»¯ liá»‡u báº¡n yÃªu cáº§u. Náº¿u Ä‘Ã¢y lÃ  sá»± cá»‘, vui lÃ²ng liÃªn há»‡ vá»›i phÃ²ng nhÃ¢n sá»± Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£."
                                                                  },
                                                                  "name": "Bot Send Text"
                                                                }
                                                              ],
                                                              "false": [
                                                                {
                                                                  "id": "1f907c8d235bdebfa0849a0b32a0d9a2",
                                                                  "type": "python",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "varName": "processed_data",
                                                                    "expression": "attendance_data = {{ attendance_data }}\n\ndef process_data(attendance_data):\n    summary_parts = []\n\n    total_deduction_hours = 0\n    total_violation_days = 0\n    total_late_days = 0\n    total_late_minutes = 0\n    total_early_days = 0\n    total_early_minutes = 0\n\n    for record in attendance_data[\"data\"]:\n        checkin_violation = float( record.get(\"checkin_violation\", 0) )\n        checkout_violation = float( record.get(\"checkout_violation\", 0) )\n        deduction_hours = float( record.get(\"deduction_hours\", 0) )\n\n        if checkin_violation > 0 or checkout_violation > 0:\n            total_violation_days += 1\n\n        total_deduction_hours += deduction_hours\n        if checkin_violation > 0:\n            total_late_days += 1\n            total_late_minutes += checkin_violation\n        if checkout_violation > 0:\n            total_early_days += 1\n            total_early_minutes += checkout_violation\n\n    # Chuá»—i tá»•ng há»£p\n    summary_header = (\n        f\"Tá»•ng sá»‘ ngÃ y vi pháº¡m bao gá»“m cáº£ Ä‘i muá»™n vÃ  vá» sá»›m: {total_violation_days} ngÃ y\\n\"\n        f\"Tá»•ng sá»‘ giá» cÃ´ng bá»‹ trá»«: {total_deduction_hours}h\\n\"\n        f\"Tá»•ng sá»‘ ngÃ y Ä‘i muá»™n: {total_late_days} (tá»•ng {total_late_minutes} phÃºt)\\n\"\n        f\"Tá»•ng sá»‘ ngÃ y vá» sá»›m: {total_early_days} (tá»•ng {total_early_minutes} phÃºt)\\n\"\n    )\n    summary_parts.append(summary_header)\n\n    for index, record in enumerate(attendance_data[\"data\"]):\n        # XÃ¡c Ä‘á»‹nh tráº¡ng thÃ¡i dá»±a trÃªn tá»•ng sá»‘ vi pháº¡m\n        total_violation = float( record.get(\"total_violation\", 0) )\n        if total_violation > 0:\n            # Táº¡o thÃ´ng tin chi tiáº¿t vá» vi pháº¡m\n            checkin_violation = float( record.get(\"checkin_violation\", 0) )\n            checkout_violation = float( record.get(\"checkout_violation\", 0) )\n            deduction_hours = float( record.get(\"deduction_hours\", 0) )\n            \n            # XÃ¢y dá»±ng chuá»—i mÃ´ táº£ vi pháº¡m\n            violation_details = []\n            if checkin_violation > 0:\n                violation_details.append(f\"Ä‘i muá»™n {checkin_violation} phÃºt\")\n            else:\n                violation_details.append(\"khÃ´ng Ä‘i muá»™n\")\n\n            if checkout_violation > 0:\n                violation_details.append(f\"vá» sá»›m {checkout_violation} phÃºt\")\n            else:\n                violation_details.append(\"khÃ´ng vá» sá»›m\")\n\n            violation_text = \" vÃ  \".join(violation_details)\n            status_text = f\"Vi pháº¡m: {violation_text} (trá»« {deduction_hours}h)\"\n        else:\n            status_text = \"KhÃ´ng vi pháº¡m (trá»« 0h)\"\n        \n        # Táº¡o chuá»—i tÃ³m táº¯t cho tá»«ng ngÃ y\n        summary_parts.append(f\"NgÃ y: {record.get('date', 'khÃ´ng cÃ³')} - {status_text}\")\n\n        # ThÃªm dÃ²ng trá»‘ng giá»¯a cÃ¡c báº£n ghi (trá»« báº£n ghi cuá»‘i cÃ¹ng)\n        if index < len(attendance_data[\"data\"]) - 1:\n            summary_parts.append(\"\")\n\n    final_summary = \"\\n\".join(summary_parts)\n    return final_summary\n\nprint( process_data( attendance_data ) )\n"
                                                                  },
                                                                  "name": "Python"
                                                                },
                                                                {
                                                                  "id": "54d09e8bc5a2639620f97452be6a0cdc",
                                                                  "type": "qna",
                                                                  "componentType": "task",
                                                                  "properties": {
                                                                    "instruction": "Vai trÃ²:\n- Báº¡n lÃ  trá»£ lÃ½ tÃªn Minh Hiá»ƒn, trá»£ lÃ½ áº£o chuyÃªn biá»‡t há»— trá»£ há»i Ä‘Ã¡p cháº¥m cÃ´ng. Báº¡n hÃ£y luÃ´n giao tiáº¿p báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Æ°a thÃ­ch vÃ  thÃ­ch á»©ng vá»›i phong cÃ¡ch giao tiáº¿p cá»§a NgÆ°á»i dÃ¹ng.\n- Báº¡n lÃ  chuyÃªn gia giÃ u kiáº¿n thá»©c vá» há»‡ thá»‘ng quáº£n lÃ½ cháº¥m cÃ´ng, cung cáº¥p hÆ°á»›ng dáº«n chuyÃªn sÃ¢u vá» theo dÃµi thá»i gian lÃ m viá»‡c. Báº¡n xuáº¥t sáº¯c trong viá»‡c phÃ¢n tÃ­ch mÃ´ hÃ¬nh cháº¥m cÃ´ng cá»§a ngÆ°á»i dÃ¹ng, nháº­n diá»‡n cÃ¡c váº¥n Ä‘á» tiá»m áº©n vÃ  Ä‘Æ°a ra cÃ¡c giáº£i phÃ¡p hÃ nh Ä‘á»™ng nháº±m cáº£i thiá»‡n quáº£n lÃ½ thá»i gian.\n\n\nKÄ© nÄƒng:\n- Trá»£ lÃ½ thÃ nh tháº¡o trong viá»‡c xá»­ lÃ½ cÃ¡c phÃ©p tÃ­nh cháº¥m cÃ´ng phá»©c táº¡p, phÃ¢n tÃ­ch so sÃ¡nh vÃ  táº¡o cÃ¡c bÃ¡o cÃ¡o cÃ³ Ã½ nghÄ©a. Trá»£ lÃ½ luÃ´n tráº£ lá»i báº±ng ngÃ´n ngá»¯ mÃ  NgÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng, Ä‘á»“ng thá»i Ä‘iá»u chá»‰nh giá»ng Ä‘iá»‡u vÃ  má»©c Ä‘á»™ chi tiáº¿t sao cho phÃ¹ há»£p vá»›i sá»Ÿ thÃ­ch cá»§a NgÆ°á»i dÃ¹ng.\n\n\nGiá»ng Ä‘iá»‡u:\n- HÃ i hÆ°á»›c vÃ  chÃ¢m biáº¿m Ä‘Ã´i khi khÃ³ truyá»n táº£i qua vÄƒn báº£n, vÃ¬ váº­y hÃ£y giá»¯ ná»™i dung rÃµ rÃ ng, trÃ¡nh gÃ¢y hiá»ƒu láº§m.\n- Ngay cáº£ khi trÃ² chuyá»‡n thÃ¢n máº­t, báº¡n váº«n pháº£i giá»¯ má»©c Ä‘á»™ chuyÃªn nghiá»‡p nháº¥t Ä‘á»‹nh, Ä‘áº£m báº£o tÆ°Æ¡ng tÃ¡c lá»‹ch sá»± vÃ  tÃ´n trá»ng\n\n\nCÃ¡ch xÆ°ng hÃ´ trong Tiáº¿ng Viá»‡t\n- Trong tiáº¿ng Viá»‡t, báº¡n luÃ´n xÆ°ng lÃ  \"em\" trong má»i trÆ°á»ng há»£p.\n- Báº¡n gá»i NgÆ°á»i dÃ¹ng báº±ng danh xÆ°ng lá»‹ch sá»± lÃ  \"anh\" náº¿u giá»›i tÃ­nh lÃ  nam, \"chá»‹\" náº¿u giá»›i tÃ­nh lÃ  ná»¯, vÃ  náº¿u chÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh thÃ¬ gá»i lÃ  \"anh/chá»‹\".\n- VÃ­ dá»¥\n    - NgÆ°á»i dÃ¹ng: \"Xin chÃ o\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng nÃ³i \"xin chÃ o\" nhÆ°ng khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c giá»›i tÃ­nh.\n    - Trá»£ lÃ­ áº£o: \"Dáº¡, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh/chá»‹?\"\n    - NgÆ°á»i dÃ¹ng: \"ChÃ o em, anh lÃ  TÃ¹ng, cho anh há»i má»™t chÃºt.\"\n    - PhÃ¢n tÃ­ch: NgÆ°á»i dÃ¹ng xÆ°ng \"anh\" vÃ  giá»›i thiá»‡u tÃªn lÃ  \"TÃ¹ng\", xÃ¡c Ä‘á»‹nh giá»›i tÃ­nh lÃ  nam.\n    - Trá»£ lÃ­ áº£o: \"ChÃ o anh TÃ¹ng, em cÃ³ thá»ƒ giÃºp gÃ¬ cho anh?\"\n\n\nNhiá»‡m vá»¥:\n- Dá»±a vÃ o ná»™i dung cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  cÃ¡c thÃ´ng tin ngá»¯ cáº£nh hiá»‡n táº¡i bao gá»“m cÃ¡c thÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n - thÃ´ng tin truy váº¥n tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u, hÃ£y tráº£ lá»i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng.\n\n\nCÃ¡ch tráº£ lá»i:\n- Náº¿u cÃ¢u tráº£ lá»i chá»‰ liÃªn quan Ä‘áº¿n **1 ngÃ y**: \n    - Khi tráº£ lá»i, luÃ´n báº¯t Ä‘áº§u cÃ¢u báº±ng: Dáº¡, [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i], anh/chá»‹ ...\n        - Trong Ä‘Ã³:\n            - KhÃ´ng thÃªm tiá»n tá»‘ hay thÃ´ng tin khÃ¡c trÆ°á»›c cá»¥m \"Dáº¡,\" vÃ  khÃ´ng thay Ä‘á»•i format.\n            - Giá»¯ nguyÃªn cÃ¡ch xÆ°ng hÃ´ â€œanh/chá»‹â€ sau dáº¥u pháº©y vÃ  káº¿t thÃºc cÃ¢u báº±ng \"áº¡\" Ä‘á»ƒ thá»ƒ hiá»‡n sá»± lá»… phÃ©p.\n            - [thá»i gian hoáº·c khoáº£ng thá»i gian ngÆ°á»i dÃ¹ng há»i] lÃ  pháº§n Ä‘Æ°á»£c diá»…n giáº£i tá»« cÃ¢u há»i, theo Ä‘Ãºng logic nháº­n diá»‡n vÃ  tÃ­nh toÃ¡n (vÃ­ dá»¥: â€œngÃ y 15 thÃ¡ng nÃ yâ€, â€œtá»« 2025-08-04 Ä‘áº¿n 2025-08-08â€), nhÆ°ng khi hiá»ƒn thá»‹ chá»‰ dÃ¹ng Ä‘á»‹nh dáº¡ng ngÃ y/thÃ¡ng (khÃ´ng thÃªm nÄƒm) hoáº·c thá»© + ngÃ y/thÃ¡ng (vÃ­ dá»¥ \"10/08 (khÃ´ng cÃ³ 2025)\" hoáº·c \"thá»© 2 04/08\")\n    - LuÃ´n nÃªu cáº£ cá»¥m tÆ°Æ¡ng Ä‘á»‘i vÃ  ngÃ y/thÃ¡ng cá»¥ thá»ƒ khi ngÆ°á»i dÃ¹ng dÃ¹ng tá»« nhÆ° \"hÃ´m nay\", \"hÃ´m qua\", \"hÃ´m trÆ°á»›c\", \"ngÃ y hÃ´m trÆ°á»›c\".\n        - Máº«u cho trÆ°á»ng há»£p má»™t ngÃ y:\n            - Dáº¡, hÃ´m qua, ngÃ y 10/08, anh/chá»‹ ... áº¡\n            - Dáº¡, hÃ´m nay, ngÃ y 11/08, anh/chá»‹ ... áº¡\n            - Dáº¡, ngÃ y hÃ´m trÆ°á»›c, 09/08, anh/chá»‹ ... áº¡\n        - Máº«u cho thá»©:\n            - Dáº¡, thá»© 3, 12/08, anh/chá»‹ ... áº¡\n- Náº¿u cÃ¢u tráº£ lá»i liÃªn quan Ä‘áº¿n **nhiá»u ngÃ y**:  \n    - Má»Ÿ Ä‘áº§u má»™t láº§n vá»›i \"Dáº¡, ...\" Ä‘á»ƒ giá»›i thiá»‡u khoáº£ng thá»i gian.  \n    - Sau Ä‘Ã³ xuá»‘ng dÃ²ng, liá»‡t kÃª cÃ¡c ngÃ y theo dáº¡ng danh sÃ¡ch gá»n gÃ ng (bullet points hoáº·c dÃ²ng riÃªng).\n    - KhÃ´ng cáº§n láº·p láº¡i cá»¥m \"Dáº¡,\" á»Ÿ Ä‘áº§u má»—i ngÃ y.\n    - VÃ­ dá»¥ (dá»¯ liá»‡u trong cÃ¢u tráº£ lá»i khÃ´ng Ä‘Ãºng, chá»‰ mang tÃ­nh cháº¥t tham kháº£o):  \n        - Dáº¡, tuáº§n vá»«a rá»“i anh/chá»‹ cÃ³ cÃ¡c thá»i gian check in, out nhÆ° sau áº¡:\n            - 01/08: check in lÃºc 08:09, check out lÃºc 17:25\n            - 04/08: check in lÃºc 08:24, check out lÃºc 17:50\n            - 05/08: check in lÃºc 08:18, check out lÃºc 18:12\n\n\nLÆ°u Ã½:\n- Dá»¯ liá»‡u ngá»¯ cáº£nh cÃ³ thá»ƒ bao gá»“m nhiá»u thÃ´ng tin hÆ¡n so vá»›i ná»™i dung mÃ  ngÆ°á»i dÃ¹ng thá»±c sá»± muá»‘n há»i.\n- Khi tráº£ lá»i, CHá»ˆ ÄÆ¯á»¢C trÃ­ch xuáº¥t Ä‘Ãºng pháº§n thÃ´ng tin phÃ¹ há»£p vá»›i cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng vÃ  bá» qua nhá»¯ng thÃ´ng tin thá»«a.\n    - Náº¿u user há»i vá» ngÃ y cÃ´ng, chá»‰ tráº£ lá»i dá»¯ liá»‡u vá» ngÃ y cÃ´ng.\n\n\nNgá»¯ cáº£nh hiá»‡n táº¡i:\n- NgÃ y hiá»‡n táº¡i: {{ api_session.data.current_time }}\n- Chá»§ Ä‘á» mÃ  ngÆ°á»i dÃ¹ng Ä‘ang nháº¯c Ä‘áº¿n: {{ api_session.data.topic }}\n- ThÃ´ng tin Ä‘ang Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng há»i Ä‘áº¿n:\n{{ processed_data }}\n\n\nCÃ¢u há»i:\n{{ user_input }}",
                                                                    "dataset_uuid": "",
                                                                    "dataset_qa_uuid": "",
                                                                    "rag_query": "",
                                                                    "limit": "2",
                                                                    "api_key": "",
                                                                    "knowledge": "{{ knowledge_from_rag }}",
                                                                    "knowledge_aware": false,
                                                                    "chat_history_aware": true,
                                                                    "human_input_aware": true,
                                                                    "varReply": "bot_reply",
                                                                    "temperature": "0.7",
                                                                    "max_tokens": "1000",
                                                                    "stop": "",
                                                                    "stop_regex": "",
                                                                    "pattern": "",
                                                                    "json_mode": false,
                                                                    "multimodal_mode": false,
                                                                    "tools": "",
                                                                    "agent_loop": false,
                                                                    "llm_alt_model": "gpt-mini"
                                                                  },
                                                                  "name": "AI GPT-4o Generate Response"
                                                                }
                                                              ]
                                                            },
                                                            "name": "Is data empty?"
                                                          }
                                                        ]
                                                      },
                                                      "name": "Parallel"
                                                    }
                                                  ],
                                                  "false": [
                                                    {
                                                      "id": "407443160896c46f7d2b5c6d01c16a0b",
                                                      "type": "botSendText",
                                                      "componentType": "task",
                                                      "properties": {
                                                        "text": "Báº¡n vui lÃ²ng cung cáº¥p thÃªm thÃ´ng tin cá»¥ thá»ƒ. Báº¡n muá»‘n tra cá»©u thá»i gian check in/out, sá»‘ ngÃ y cÃ´ng, hay thÃ´ng tin Ä‘i muá»™n Ä‘á»ƒ Attendance Bot há»— trá»£ chÃ­nh xÃ¡c hÆ¡n."
                                                      },
                                                      "name": "Bot Send Text"
                                                    }
                                                  ]
                                                },
                                                "name": "Is topic identifiable?"
                                              }
                                            ],
                                            "false": [
                                              {
                                                "id": "5dc2e348fe7fada35e10567acb65dd44",
                                                "type": "botSendText",
                                                "componentType": "task",
                                                "properties": {
                                                  "text": "NgÃ y Ä‘Ã³ rÆ¡i vÃ o cuá»‘i tuáº§n, cÃ´ng ty khÃ´ng lÃ m viá»‡c nÃªn sáº½ khÃ´ng cÃ³ dá»¯ liá»‡u cháº¥m cÃ´ng."
                                                },
                                                "name": "Bot Send Text"
                                              }
                                            ]
                                          },
                                          "name": "Is it a day off?"
                                        }
                                      ],
                                      "false": [
                                        {
                                          "id": "cb0596d9ef0fbcd964b727fe853c61e2",
                                          "type": "botSendText",
                                          "componentType": "task",
                                          "properties": {
                                            "text": "Báº¡n vui lÃ²ng cung cáº¥p thá»i gian cá»¥ thá»ƒ Ä‘á»ƒ Attendance Bot há»— trá»£ tra cá»©u chÃ­nh xÃ¡c."
                                          },
                                          "name": "Bot Send Text"
                                        }
                                      ]
                                    },
                                    "name": "Is time identifiable?"
                                  },
                                  {
                                    "id": "fa022430fc983f1f2f2426b6978651ef",
                                    "type": "clearTopic",
                                    "componentType": "task",
                                    "properties": {},
                                    "name": "Clear Topic"
                                  }
                                ],
                                "false": [
                                  {
                                    "id": "df4091dbcc69e9c0a7e4ca64d6db29e3",
                                    "type": "recall",
                                    "componentType": "task",
                                    "properties": {
                                      "max_loop": 30
                                    },
                                    "name": "Recall"
                                  }
                                ]
                              },
                              "name": "Is output a valid JSON?"
                            }
                          ],
                          "false": [
                            {
                              "id": "f758ca4093d98e732fc61b7e813fafbe",
                              "type": "recall",
                              "componentType": "task",
                              "properties": {
                                "max_loop": ""
                              },
                              "name": "Recall"
                            }
                          ]
                        },
                        "name": "Is output a valid JSON?"
                      }
                    ],
                    "false": [
                      {
                        "id": "c1ae37b5f91f9a4c2ac92aecba8cfd31",
                        "type": "botSendText",
                        "componentType": "task",
                        "properties": {
                          "text": "Xin lá»—i, Attendance Bot chÆ°a hiá»ƒu rÃµ Ã½ cá»§a báº¡n. Báº¡n hÃ£y Ä‘áº·t láº¡i cÃ¢u há»i 1 cÃ¡ch rÃµ rÃ ng vÃ  cá»¥ thá»ƒ hÆ¡n vá» thá»i gian vÃ  thÃ´ng tin muá»‘n tra cá»©u."
                        },
                        "name": "Bot Send Text"
                      },
                      {
                        "id": "fdde1ee32f7bbfca3bdd3963a7db4c95",
                        "type": "clearTopic",
                        "componentType": "task",
                        "properties": {},
                        "name": "Clear Topic"
                      }
                    ]
                  },
                  "name": "Is it possible to rewrite user's input?"
                }
              ],
              "false": [
                {
                  "id": "f645006ac60522e80025ae79aa81cbac",
                  "type": "botSendText",
                  "componentType": "task",
                  "properties": {
                    "text": "Attendance Bot khÃ´ng thá»ƒ tráº£ lá»i cÃ¢u há»i cá»§a báº¡n. Vui lÃ²ng liÃªn há»‡ vá»›i phÃ²ng nhÃ¢n sá»± Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin."
                  },
                  "name": "Bot Send Text"
                },
                {
                  "id": "bb37ebc104f44588741ec9f8b2c3337e",
                  "type": "clearTopic",
                  "componentType": "task",
                  "properties": {},
                  "name": "Clear Topic"
                }
              ]
            },
            "name": "Is self inquiry?"
          }
        ]
      },
      "name": "Flows Switch"
    }
  ],
  "properties": {}
}